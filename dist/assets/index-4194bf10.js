import{R as e,P as t,E as s,V as i,M as n,T as o,Q as r,S as a,a as l,b as c,O as h,c as d,B as u,F as m,d as g,U as p,W as f,H as y,N as w,C as v,e as x,A as b,f as T,g as A,h as M,i as S,L as P,j as I,k as E,l as L,m as C,n as R,D,o as _,p as N,q as B,I as k,r as O,s as F,t as H,u as j,v as U,w as z,x as G,y as K,z as V,G as X,J as Y,K as $,X as q,Y as W,Z as Q,_ as Z,$ as J,a0 as ee,a1 as te,a2 as se,a3 as ie,a4 as ne,a5 as oe,a6 as re,a7 as ae,a8 as le,a9 as ce,aa as he,ab as de,ac as ue,ad as me,ae as ge,af as pe,ag as fe,ah as ye,ai as we,aj as ve,ak as xe,al as be,am as Te,an as Ae,ao as Me,ap as Se,aq as Pe,ar as Ie,as as Ee,at as Le,au as Ce,av as Re,aw as De,ax as _e,ay as Ne,az as Be,aA as ke,aB as Oe,aC as Fe,aD as He,aE as je,aF as Ue,aG as ze,aH as Ge,aI as Ke}from"./three-67f40818.js";import{T as Ve,E as Xe,u as Ye}from"./tween-408c4479.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const $e={},qe={type:"change"},We={type:"start"},Qe={type:"end"},Ze=new e,Je=new t,et=Math.cos(70*c.DEG2RAD);class tt extends s{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i,this.cursor=new i,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.ROTATE,MIDDLE:n.DOLLY,RIGHT:n.PAN},this.touches={ONE:o.ROTATE,TWO:o.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(qe),s.update(),h=c.NONE},this.update=function(){const t=new i,n=(new r).setFromUnitVectors(e.up,new i(0,1,0)),o=n.clone().invert(),a=new i,l=new r,f=new i,y=2*Math.PI;return function(r=null){const w=s.object.position;t.copy(w).sub(s.target),t.applyQuaternion(n),u.setFromVector3(t),s.autoRotate&&h===c.NONE&&R(function(e){return null!==e?2*Math.PI/60*s.autoRotateSpeed*e:2*Math.PI/60/60*s.autoRotateSpeed}(r)),s.enableDamping?(u.theta+=m.theta*s.dampingFactor,u.phi+=m.phi*s.dampingFactor):(u.theta+=m.theta,u.phi+=m.phi);let v=s.minAzimuthAngle,x=s.maxAzimuthAngle;isFinite(v)&&isFinite(x)&&(v<-Math.PI?v+=y:v>Math.PI&&(v-=y),x<-Math.PI?x+=y:x>Math.PI&&(x-=y),u.theta=v<=x?Math.max(v,Math.min(x,u.theta)):u.theta>(v+x)/2?Math.max(v,u.theta):Math.min(x,u.theta)),u.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,u.phi)),u.makeSafe(),!0===s.enableDamping?s.target.addScaledVector(p,s.dampingFactor):s.target.add(p),s.target.sub(s.cursor),s.target.clampLength(s.minTargetRadius,s.maxTargetRadius),s.target.add(s.cursor),s.zoomToCursor&&I||s.object.isOrthographicCamera?u.radius=H(u.radius):u.radius=H(u.radius*g),t.setFromSpherical(u),t.applyQuaternion(o),w.copy(s.target).add(t),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,p.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),p.set(0,0,0));let b=!1;if(s.zoomToCursor&&I){let n=null;if(s.object.isPerspectiveCamera){const e=t.length();n=H(e*g);const i=e-n;s.object.position.addScaledVector(S,i),s.object.updateMatrixWorld()}else if(s.object.isOrthographicCamera){const e=new i(P.x,P.y,0);e.unproject(s.object),s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/g)),s.object.updateProjectionMatrix(),b=!0;const o=new i(P.x,P.y,0);o.unproject(s.object),s.object.position.sub(o).add(e),s.object.updateMatrixWorld(),n=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),s.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?s.target.set(0,0,-1).transformDirection(s.object.matrix).multiplyScalar(n).add(s.object.position):(Ze.origin.copy(s.object.position),Ze.direction.set(0,0,-1).transformDirection(s.object.matrix),Math.abs(s.object.up.dot(Ze.direction))<et?e.lookAt(s.target):(Je.setFromNormalAndCoplanarPoint(s.object.up,s.target),Ze.intersectPlane(Je,s.target))))}else s.object.isOrthographicCamera&&(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/g)),s.object.updateProjectionMatrix(),b=!0);return g=1,I=!1,!!(b||a.distanceToSquared(s.object.position)>d||8*(1-l.dot(s.object.quaternion))>d||f.distanceToSquared(s.target)>0)&&(s.dispatchEvent(qe),a.copy(s.object.position),l.copy(s.object.quaternion),f.copy(s.target),b=!1,!0)}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",J),s.domElement.removeEventListener("pointerdown",$),s.domElement.removeEventListener("pointercancel",W),s.domElement.removeEventListener("wheel",Q),s.domElement.removeEventListener("pointermove",q),s.domElement.removeEventListener("pointerup",W),null!==s._domElementKeyEvents&&(s._domElementKeyEvents.removeEventListener("keydown",Z),s._domElementKeyEvents=null)};const s=this,c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=c.NONE;const d=1e-6,u=new a,m=new a;let g=1;const p=new i,f=new l,y=new l,w=new l,v=new l,x=new l,b=new l,T=new l,A=new l,M=new l,S=new i,P=new l;let I=!1;const E=[],L={};function C(){return Math.pow(.95,s.zoomSpeed)}function R(e){m.theta-=e}function D(e){m.phi-=e}const _=function(){const e=new i;return function(t,s){e.setFromMatrixColumn(s,0),e.multiplyScalar(-t),p.add(e)}}(),N=function(){const e=new i;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),B=function(){const e=new i;return function(t,i){const n=s.domElement;if(s.object.isPerspectiveCamera){const o=s.object.position;e.copy(o).sub(s.target);let r=e.length();r*=Math.tan(s.object.fov/2*Math.PI/180),_(2*t*r/n.clientHeight,s.object.matrix),N(2*i*r/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(_(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),N(i*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function k(e){s.object.isPerspectiveCamera||s.object.isOrthographicCamera?g/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function O(e){s.object.isPerspectiveCamera||s.object.isOrthographicCamera?g*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(e){if(!s.zoomToCursor)return;I=!0;const t=s.domElement.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,o=t.width,r=t.height;P.x=i/o*2-1,P.y=-n/r*2+1,S.set(P.x,P.y,1).unproject(s.object).sub(s.object.position).normalize()}function H(e){return Math.max(s.minDistance,Math.min(s.maxDistance,e))}function j(e){f.set(e.clientX,e.clientY)}function U(e){v.set(e.clientX,e.clientY)}function z(){if(1===E.length)f.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);f.set(e,t)}}function G(){if(1===E.length)v.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);v.set(e,t)}}function K(){const e=E[0].pageX-E[1].pageX,t=E[0].pageY-E[1].pageY,s=Math.sqrt(e*e+t*t);T.set(0,s)}function V(e){if(1==E.length)y.set(e.pageX,e.pageY);else{const t=te(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);y.set(s,i)}w.subVectors(y,f).multiplyScalar(s.rotateSpeed);const t=s.domElement;R(2*Math.PI*w.x/t.clientHeight),D(2*Math.PI*w.y/t.clientHeight),f.copy(y)}function X(e){if(1===E.length)x.set(e.pageX,e.pageY);else{const t=te(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);x.set(s,i)}b.subVectors(x,v).multiplyScalar(s.panSpeed),B(b.x,b.y),v.copy(x)}function Y(e){const t=te(e),i=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(i*i+n*n);A.set(0,o),M.set(0,Math.pow(A.y/T.y,s.zoomSpeed)),k(M.y),T.copy(A)}function $(e){!1!==s.enabled&&(0===E.length&&(s.domElement.setPointerCapture(e.pointerId),s.domElement.addEventListener("pointermove",q),s.domElement.addEventListener("pointerup",W)),function(e){E.push(e)}(e),"touch"===e.pointerType?function(e){switch(ee(e),E.length){case 1:switch(s.touches.ONE){case o.ROTATE:if(!1===s.enableRotate)return;z(),h=c.TOUCH_ROTATE;break;case o.PAN:if(!1===s.enablePan)return;G(),h=c.TOUCH_PAN;break;default:h=c.NONE}break;case 2:switch(s.touches.TWO){case o.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;s.enableZoom&&K(),s.enablePan&&G(),h=c.TOUCH_DOLLY_PAN;break;case o.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;s.enableZoom&&K(),s.enableRotate&&z(),h=c.TOUCH_DOLLY_ROTATE;break;default:h=c.NONE}break;default:h=c.NONE}h!==c.NONE&&s.dispatchEvent(We)}(e):function(e){let t;switch(e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.DOLLY:if(!1===s.enableZoom)return;!function(e){F(e),T.set(e.clientX,e.clientY)}(e),h=c.DOLLY;break;case n.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;U(e),h=c.PAN}else{if(!1===s.enableRotate)return;j(e),h=c.ROTATE}break;case n.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;j(e),h=c.ROTATE}else{if(!1===s.enablePan)return;U(e),h=c.PAN}break;default:h=c.NONE}h!==c.NONE&&s.dispatchEvent(We)}(e))}function q(e){!1!==s.enabled&&("touch"===e.pointerType?function(e){switch(ee(e),h){case c.TOUCH_ROTATE:if(!1===s.enableRotate)return;V(e),s.update();break;case c.TOUCH_PAN:if(!1===s.enablePan)return;X(e),s.update();break;case c.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&Y(e),s.enablePan&&X(e)}(e),s.update();break;case c.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&Y(e),s.enableRotate&&V(e)}(e),s.update();break;default:h=c.NONE}}(e):function(e){switch(h){case c.ROTATE:if(!1===s.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),w.subVectors(y,f).multiplyScalar(s.rotateSpeed);const t=s.domElement;R(2*Math.PI*w.x/t.clientHeight),D(2*Math.PI*w.y/t.clientHeight),f.copy(y),s.update()}(e);break;case c.DOLLY:if(!1===s.enableZoom)return;!function(e){A.set(e.clientX,e.clientY),M.subVectors(A,T),M.y>0?k(C()):M.y<0&&O(C()),T.copy(A),s.update()}(e);break;case c.PAN:if(!1===s.enablePan)return;!function(e){x.set(e.clientX,e.clientY),b.subVectors(x,v).multiplyScalar(s.panSpeed),B(b.x,b.y),v.copy(x),s.update()}(e)}}(e))}function W(e){!function(e){delete L[e.pointerId];for(let t=0;t<E.length;t++)if(E[t].pointerId==e.pointerId)return void E.splice(t,1)}(e),0===E.length&&(s.domElement.releasePointerCapture(e.pointerId),s.domElement.removeEventListener("pointermove",q),s.domElement.removeEventListener("pointerup",W)),s.dispatchEvent(Qe),h=c.NONE}function Q(e){!1!==s.enabled&&!1!==s.enableZoom&&h===c.NONE&&(e.preventDefault(),s.dispatchEvent(We),function(e){F(e),e.deltaY<0?O(C()):e.deltaY>0&&k(C()),s.update()}(e),s.dispatchEvent(Qe))}function Z(e){!1!==s.enabled&&!1!==s.enablePan&&function(e){let t=!1;switch(e.code){case s.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?D(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):B(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?D(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):B(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?R(2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):B(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?R(-2*Math.PI*s.rotateSpeed/s.domElement.clientHeight):B(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function J(e){!1!==s.enabled&&e.preventDefault()}function ee(e){let t=L[e.pointerId];void 0===t&&(t=new l,L[e.pointerId]=t),t.set(e.pageX,e.pageY)}function te(e){const t=e.pointerId===E[0].pointerId?E[1]:E[0];return L[t.pointerId]}s.domElement.addEventListener("contextmenu",J),s.domElement.addEventListener("pointerdown",$),s.domElement.addEventListener("pointercancel",W),s.domElement.addEventListener("wheel",Q,{passive:!1}),this.update()}}const st={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class it{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const nt=new h(-1,1,1,-1,0,1);const ot=new class extends u{constructor(){super(),this.setAttribute("position",new m([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new m([0,2,0,0,2,0],2))}};class rt{constructor(e){this._mesh=new d(ot,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,nt)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class at extends it{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof g?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=p.clone(e.uniforms),this.material=new g({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new rt(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class lt extends it{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),n=e.state;let o,r;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(o=0,r=1):(o=1,r=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),n.buffers.stencil.setClear(r),n.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class ct extends it{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class ht{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const s=e.getSize(new l);this._width=s.width,this._height=s.height,(t=new f(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:y})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new at(st),this.copyPass.material.blending=w,this.clock=new v}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,n=this.passes.length;i<n;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),t.needsSwap){if(s){const t=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==lt&&(t instanceof lt?s=!0:t instanceof ct&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new l);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class dt extends it{constructor(e,t,s=null,i=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new x}render(e,t,s){const i=e.autoClear;let n,o;e.autoClear=!1,null!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),null!==this.clearAlpha&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(n),null!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=i}}const ut={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new x(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class mt extends it{constructor(e,t,s,n){super(),this.strength=void 0!==t?t:1,this.radius=s,this.threshold=n,this.resolution=void 0!==e?new l(e.x,e.y):new l(256,256),this.clearColor=new x(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let o=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new f(o,r,{type:y}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let i=0;i<this.nMips;i++){const e=new f(o,r,{type:y});e.texture.name="UnrealBloomPass.h"+i,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const t=new f(o,r,{type:y});t.texture.name="UnrealBloomPass.v"+i,t.texture.generateMipmaps=!1,this.renderTargetsVertical.push(t),o=Math.round(o/2),r=Math.round(r/2)}const a=ut;this.highPassUniforms=p.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new g({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];o=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let i=0;i<this.nMips;i++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[i])),this.separableBlurMaterials[i].uniforms.invSize.value=new l(1/o,1/r),o=Math.round(o/2),r=Math.round(r/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new i(1,1,1),new i(1,1,1),new i(1,1,1),new i(1,1,1),new i(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const h=st;this.copyUniforms=p.clone(h.uniforms),this.blendMaterial=new g({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:b,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new x,this.oldClearAlpha=1,this.basic=new T,this.fsQuad=new rt(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let s=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(s,i);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(s,i),this.renderTargetsVertical[n].setSize(s,i),this.separableBlurMaterials[n].uniforms.invSize.value=new l(1/s,1/i),s=Math.round(s/2),i=Math.round(i/2)}render(e,t,s,i,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=s.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let r=this.renderTargetBright;for(let a=0;a<this.nMips;a++)this.fsQuad.material=this.separableBlurMaterials[a],this.separableBlurMaterials[a].uniforms.colorTexture.value=r.texture,this.separableBlurMaterials[a].uniforms.direction.value=mt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[a]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurMaterials[a].uniforms.direction.value=mt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[a]),e.clear(),this.fsQuad.render(e),r=this.renderTargetsVertical[a];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return new g({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new l(.5,.5)},direction:{value:new l(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new g({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}function gt(e,t){if(t===A)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===M||t===S){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const i=s.count-2,n=[];if(t===M)for(let e=1;e<=i;e++)n.push(s.getX(0)),n.push(s.getX(e)),n.push(s.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(s.getX(e)),n.push(s.getX(e+1)),n.push(s.getX(e+2))):(n.push(s.getX(e+2)),n.push(s.getX(e+1)),n.push(s.getX(e)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(n),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}mt.BlurDirectionX=new l(1,0),mt.BlurDirectionY=new l(0,1);class pt extends P{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new bt(e)}),this.register(function(e){return new Lt(e)}),this.register(function(e){return new Ct(e)}),this.register(function(e){return new Rt(e)}),this.register(function(e){return new At(e)}),this.register(function(e){return new Mt(e)}),this.register(function(e){return new St(e)}),this.register(function(e){return new Pt(e)}),this.register(function(e){return new xt(e)}),this.register(function(e){return new It(e)}),this.register(function(e){return new Tt(e)}),this.register(function(e){return new Et(e)}),this.register(function(e){return new wt(e)}),this.register(function(e){return new Dt(e)}),this.register(function(e){return new _t(e)})}load(e,t,s,i){const n=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:I.extractUrlBase(e),this.manager.itemStart(e);const r=function(t){i?i(t):console.error(t),n.manager.itemError(e),n.manager.itemEnd(e)},a=new E(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(s){try{n.parse(s,o,function(s){t(s),n.manager.itemEnd(e)},r)}catch(i){r(i)}},s,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let n;const o={},r={},a=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===Nt){try{o[yt.KHR_BINARY_GLTF]=new Ot(e)}catch(c){return void(i&&i(c))}n=JSON.parse(o[yt.KHR_BINARY_GLTF].content)}else n=JSON.parse(a.decode(e))}else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new cs(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const e=this.pluginCallbacks[h](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[e.name]=e,o[e.name]=!0}if(n.extensionsUsed)for(let h=0;h<n.extensionsUsed.length;++h){const e=n.extensionsUsed[h],t=n.extensionsRequired||[];switch(e){case yt.KHR_MATERIALS_UNLIT:o[e]=new vt;break;case yt.KHR_DRACO_MESH_COMPRESSION:o[e]=new Ft(n,this.dracoLoader);break;case yt.KHR_TEXTURE_TRANSFORM:o[e]=new Ht;break;case yt.KHR_MESH_QUANTIZATION:o[e]=new jt;break;default:t.indexOf(e)>=0&&void 0===r[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(o),l.setPlugins(r),l.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,t,i,n)})}}function ft(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const yt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wt{constructor(e){this.parser=e,this.name=yt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const n=t.json,o=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let r;const a=new x(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],L);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":r=new D(a),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new R(a),r.distance=l;break;case"spot":r=new C(a),r.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,r.angle=o.spot.outerConeAngle,r.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return r.position.set(0,0,0),r.decay=2,is(r,o),void 0!==o.intensity&&(r.intensity=o.intensity),r.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(r),t.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return s._getNodeRef(t.cache,n,e)})}}class vt{constructor(){this.name=yt.KHR_MATERIALS_UNLIT}getMaterialType(){return T}extendParams(e,t,s){const i=[];e.color=new x(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],L),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(s.assignTexture(e,"map",n.baseColorTexture,_))}return Promise.all(i)}}class xt{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class bt{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l(e,e)}return Promise.all(n)}}class Tt{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&n.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&n.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(n)}}class At{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new x(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],L)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&n.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,_)),void 0!==o.sheenRoughnessTexture&&n.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(n)}}class Mt{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(n)}}class St{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&n.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const r=o.attenuationColor||[1,1,1];return t.attenuationColor=(new x).setRGB(r[0],r[1],r[2],L),Promise.all(n)}}class Pt{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class It{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&n.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return t.specularColor=(new x).setRGB(r[0],r[1],r[2],L),void 0!==o.specularColorTexture&&n.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,_)),Promise.all(n)}}class Et{constructor(e){this.parser=e,this.name=yt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?N:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],o=i.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&n.push(s.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(n)}}class Lt{constructor(e){this.parser=e,this.name=yt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,o)}}class Ct{constructor(e){this.parser=e,this.name=yt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const o=n.extensions[t],r=i.images[o.source];let a=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(a=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Rt{constructor(e){this.parser=e,this.name=yt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const o=n.extensions[t],r=i.images[o.source];let a=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(a=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Dt{constructor(e){this.name=yt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const s=e.byteOffset||0,i=e.byteLength||0,o=e.count,r=e.byteStride,a=new Uint8Array(t,s,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(o,r,a,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){const t=new ArrayBuffer(o*r);return n.decodeGltfBuffer(new Uint8Array(t),o,r,a,e.mode,e.filter),t})})}return null}}class _t{constructor(e){this.name=yt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const n=t.meshes[s.mesh];for(const i of n.primitives)if(i.mode!==Kt.TRIANGLES&&i.mode!==Kt.TRIANGLE_STRIP&&i.mode!==Kt.TRIANGLE_FAN&&void 0!==i.mode)return null;const o=s.extensions[this.name].attributes,a=[],l={};for(const i in o)a.push(this.parser.getDependency("accessor",o[i]).then(e=>(l[i]=e,l[i])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{const t=e.pop(),s=t.isGroup?t.children:[t],n=e[0].count,o=[];for(const a of s){const e=new B,t=new i,s=new r,c=new i(1,1,1),h=new k(a.geometry,a.material,n);for(let i=0;i<n;i++)l.TRANSLATION&&t.fromBufferAttribute(l.TRANSLATION,i),l.ROTATION&&s.fromBufferAttribute(l.ROTATION,i),l.SCALE&&c.fromBufferAttribute(l.SCALE,i),h.setMatrixAt(i,e.compose(t,s,c));for(const i in l)if("_COLOR_0"===i){const e=l[i];h.instanceColor=new O(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&a.geometry.setAttribute(i,l[i]);F.prototype.copy.call(h,a),this.parser.assignFinalMaterial(h),o.push(h)}return t.isGroup?(t.clear(),t.add(...o),t):o[0]}))}}const Nt="glTF",Bt=1313821514,kt=5130562;class Ot{constructor(e){this.name=yt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Nt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,n=new DataView(e,12);let o=0;for(;o<i;){const t=n.getUint32(o,!0);o+=4;const i=n.getUint32(o,!0);if(o+=4,i===Bt){const i=new Uint8Array(e,12+o,t);this.content=s.decode(i)}else if(i===kt){const s=12+o;this.body=e.slice(s,s+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ft{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=yt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,r={},a={},l={};for(const c in o){const e=qt[c]||c.toLowerCase();r[e]=o[c]}for(const c in e.attributes){const t=qt[c]||c.toLowerCase();if(void 0!==o[c]){const i=s.accessors[e.attributes[c]],n=Vt[i.componentType];l[t]=n.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const s=e.attributes[t],i=a[t];void 0!==i&&(s.normalized=i)}t(e)},r,l)})})}}class Ht{constructor(){this.name=yt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class jt{constructor(){this.name=yt.KHR_MESH_QUANTIZATION}}class Ut extends Se{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let o=0;o!==i;o++)t[o]=s[n+o];return t}interpolate_(e,t,s,i){const n=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=2*r,l=3*r,c=i-t,h=(s-t)/c,d=h*h,u=d*h,m=e*l,g=m-l,p=-2*u+3*d,f=u-d,y=1-p,w=f-d+h;for(let v=0;v!==r;v++){const e=o[g+v+r],t=o[g+v+a]*c,s=o[m+v+r],i=o[m+v]*c;n[v]=y*e+w*t+p*s+f*i}return n}}const zt=new r;class Gt extends Ut{interpolate_(e,t,s,i){const n=super.interpolate_(e,t,s,i);return zt.fromArray(n).normalize().toArray(n),n}}const Kt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Vt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xt={9728:he,9729:G,9984:de,9985:ue,9986:me,9987:K},Yt={33071:ge,33648:pe,10497:V},$t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Wt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Qt={CUBICSPLINE:void 0,LINEAR:le,STEP:fe},Zt="OPAQUE",Jt="MASK",es="BLEND";function ts(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new q({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ye})),e.DefaultMaterial}function ss(e,t,s){for(const i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function is(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ns(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,i=s.length;t<i;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function os(e){let t;const s=e.extensions&&e.extensions[yt.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+rs(s.attributes):e.indices+":"+rs(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,n=e.targets.length;i<n;i++)t+=":"+rs(e.targets[i]);return t}function rs(e){let t="";const s=Object.keys(e).sort();for(let i=0,n=s.length;i<n;i++)t+=s[i]+":"+e[s[i]]+";";return t}function as(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const ls=new B;class cs{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ft,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=!1,n=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,n=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||i&&n<98?this.textureLoader=new H(this.options.manager):this.textureLoader=new j(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new E(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(t){const o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};return ss(n,o,i),is(o,i),Promise.all(s._invokeAll(function(e){return e.afterRoot&&e.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let i=0,n=e.length;i<n;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(s[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),n=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[i,o]of e.children.entries())n(o,t.children[i])};return n(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[yt.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,n){s.load(I.resolveURL(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=$t[i.type],t=Vt[i.componentType],s=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new U(n,e,s))}const n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){const n=e[0],o=$t[i.type],r=Vt[i.componentType],a=r.BYTES_PER_ELEMENT,l=a*o,c=i.byteOffset||0,h=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let u,m;if(h&&h!==l){const e=Math.floor(c/h),s="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(s);l||(u=new r(n,e*h,i.count*h/a),l=new z(u,h/a),t.cache.add(s,l)),m=new we(l,o,c%h/a,d)}else u=null===n?new r(i.count*o):new r(n,c,i.count*o),m=new U(u,o,d);if(void 0!==i.sparse){const t=$t.SCALAR,s=Vt[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new s(e[1],a,i.sparse.count*t),h=new r(e[2],l,i.sparse.count*o);null!==n&&(m=new U(m.array.slice(),m.itemSize,m.normalized));for(let e=0,i=c.length;e<i;e++){const t=c[e];if(m.setX(t,h[e*o]),o>=2&&m.setY(t,h[e*o+1]),o>=3&&m.setZ(t,h[e*o+2]),o>=4&&m.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,n=t.images[i];let o=this.textureLoader;if(n.uri){const e=s.manager.getHandler(n.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,s){const i=this,n=this.json,o=n.textures[e],r=n.images[t],a=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,s).then(function(t){t.flipY=!1,t.name=o.name||r.name||"",""===t.name&&"string"==typeof r.uri&&!1===r.uri.startsWith("data:image/")&&(t.name=r.uri);const s=(n.samplers||{})[o.sampler]||{};return t.magFilter=Xt[s.magFilter]||G,t.minFilter=Xt[s.minFilter]||K,t.wrapS=Yt[s.wrapS]||V,t.wrapT=Yt[s.wrapT]||V,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const s=this,i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const o=i.images[e],r=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(void 0!==o.bufferView)a=s.getDependency("bufferView",o.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return a=r.createObjectURL(t),a});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(a).then(function(e){return new Promise(function(s,i){let o=s;!0===t.isImageBitmapLoader&&(o=function(e){const t=new ve(e);t.needsUpdate=!0,s(t)}),t.load(I.resolveURL(e,n.path),o,void 0,i)})}).then(function(e){var t;return!0===l&&r.revokeObjectURL(a),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e});return this.sourceCache[e]=c,c}assignTexture(e,t,s,i){const n=this;return this.getDependency("texture",s.index).then(function(o){if(!o)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((o=o.clone()).channel=s.texCoord),n.extensions[yt.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[yt.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(o);o=n.extensions[yt.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),n.associations.set(o,t)}}return void 0!==i&&(o.colorSpace=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new X,Y.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new $,Y.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(i||n||o){let e="ClonedMaterial:"+s.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),n&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return q}loadMaterial(e){const t=this,s=this.json,i=this.extensions,n=s.materials[e];let o;const r={},a=[];if((n.extensions||{})[yt.KHR_MATERIALS_UNLIT]){const e=i[yt.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),a.push(e.extendParams(r,n,t))}else{const s=n.pbrMetallicRoughness||{};if(r.color=new x(1,1,1),r.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],L),r.opacity=e[3]}void 0!==s.baseColorTexture&&a.push(t.assignTexture(r,"map",s.baseColorTexture,_)),r.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,r.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(a.push(t.assignTexture(r,"metalnessMap",s.metallicRoughnessTexture)),a.push(t.assignTexture(r,"roughnessMap",s.metallicRoughnessTexture))),o=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,r)})))}!0===n.doubleSided&&(r.side=W);const c=n.alphaMode||Zt;if(c===es?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,c===Jt&&(r.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&o!==T&&(a.push(t.assignTexture(r,"normalMap",n.normalTexture)),r.normalScale=new l(1,1),void 0!==n.normalTexture.scale)){const e=n.normalTexture.scale;r.normalScale.set(e,e)}if(void 0!==n.occlusionTexture&&o!==T&&(a.push(t.assignTexture(r,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(r.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&o!==T){const e=n.emissiveFactor;r.emissive=(new x).setRGB(e[0],e[1],e[2],L)}return void 0!==n.emissiveTexture&&o!==T&&a.push(t.assignTexture(r,"emissiveMap",n.emissiveTexture,_)),Promise.all(a).then(function(){const s=new o(r);return n.name&&(s.name=n.name),is(s,n),t.associations.set(s,{materials:e}),n.extensions&&ss(i,s,n),s})}createUniqueName(e){const t=Q.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function n(e){return s[yt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(s){return hs(s,e,t)})}const o=[];for(let r=0,a=e.length;r<a;r++){const s=e[r],a=os(s),l=i[a];if(l)o.push(l.promise);else{let e;e=s.extensions&&s.extensions[yt.KHR_DRACO_MESH_COMPRESSION]?n(s):hs(new u,s,t),i[a]={primitive:s,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,i=this.extensions,n=s.meshes[e],o=n.primitives,r=[];for(let a=0,l=o.length;a<l;a++){const e=void 0===o[a].material?ts(this.cache):this.getDependency("material",o[a].material);r.push(e)}return r.push(t.loadGeometries(o)),Promise.all(r).then(function(s){const r=s.slice(0,s.length-1),a=s[s.length-1],l=[];for(let h=0,u=a.length;h<u;h++){const s=a[h],c=o[h];let u;const m=r[h];if(c.mode===Kt.TRIANGLES||c.mode===Kt.TRIANGLE_STRIP||c.mode===Kt.TRIANGLE_FAN||void 0===c.mode)u=!0===n.isSkinnedMesh?new Z(s,m):new d(s,m),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===Kt.TRIANGLE_STRIP?u.geometry=gt(u.geometry,S):c.mode===Kt.TRIANGLE_FAN&&(u.geometry=gt(u.geometry,M));else if(c.mode===Kt.LINES)u=new J(s,m);else if(c.mode===Kt.LINE_STRIP)u=new ee(s,m);else if(c.mode===Kt.LINE_LOOP)u=new te(s,m);else{if(c.mode!==Kt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new se(s,m)}Object.keys(u.geometry.morphAttributes).length>0&&ns(u,n),u.name=t.createUniqueName(n.name||"mesh_"+e),is(u,n),c.extensions&&ss(i,u,c),t.assignFinalMaterial(u),l.push(u)}for(let i=0,n=l.length;i<n;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return n.extensions&&ss(i,l[0],n),l[0];const c=new ie;n.extensions&&ss(i,c,n),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?t=new ne(c.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(t=new h(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),is(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s=[];for(let i=0,n=t.joints.length;i<n;i++)s.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(e){const s=e.pop(),i=e,n=[],o=[];for(let r=0,a=i.length;r<a;r++){const e=i[r];if(e){n.push(e);const t=new B;null!==s&&t.fromArray(s.array,16*r),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}return new oe(n,o)})}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,o=[],r=[],a=[],l=[],c=[];for(let h=0,d=i.channels.length;h<d;h++){const e=i.channels[h],t=i.samplers[e.sampler],s=e.target,n=s.node,d=void 0!==i.parameters?i.parameters[t.input]:t.input,u=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==s.node&&(o.push(this.getDependency("node",n)),r.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",u)),l.push(t),c.push(s))}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],i=e[1],o=e[2],r=e[3],a=e[4],l=[];for(let n=0,c=t.length;n<c;n++){const e=t[n],c=i[n],h=o[n],d=r[n],u=a[n];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const m=s._createAnimationTracks(e,c,h,d,u);if(m)for(let t=0;t<m.length;t++)l.push(m[t])}return new re(n,void 0,l)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return void 0===i.mesh?null:s.getDependency("mesh",i.mesh).then(function(e){const t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,s=this.json.nodes[e],i=t._loadNodeShallow(e),n=[],o=s.children||[];for(let a=0,l=o.length;a<l;a++)n.push(t.getDependency("node",o[a]));const r=void 0===s.skin?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(n),r]).then(function(e){const t=e[0],s=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,ls)});for(let n=0,o=s.length;n<o;n++)t.add(s[n]);return t})}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const n=t.nodes[e],o=n.name?i.createUniqueName(n.name):"",r=[],a=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&r.push(a),void 0!==n.camera&&r.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){r.push(e)}),this.nodeCache[e]=Promise.all(r).then(function(t){let r;if(r=!0===n.isBone?new ae:t.length>1?new ie:1===t.length?t[0]:new F,r!==t[0])for(let e=0,s=t.length;e<s;e++)r.add(t[e]);if(n.name&&(r.userData.name=n.name,r.name=o),is(r,n),n.extensions&&ss(s,r,n),void 0!==n.matrix){const e=new B;e.fromArray(n.matrix),r.applyMatrix4(e)}else void 0!==n.translation&&r.position.fromArray(n.translation),void 0!==n.rotation&&r.quaternion.fromArray(n.rotation),void 0!==n.scale&&r.scale.fromArray(n.scale);return i.associations.has(r)||i.associations.set(r,{}),i.associations.get(r).nodes=e,r}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,n=new ie;s.name&&(n.name=i.createUniqueName(s.name)),is(n,s),s.extensions&&ss(t,n,s);const o=s.nodes||[],r=[];for(let a=0,l=o.length;a<l;a++)r.push(i.getDependency("node",o[a]));return Promise.all(r).then(function(e){for(let t=0,s=e.length;t<s;t++)n.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[s,n]of i.associations)(s instanceof Y||s instanceof ve)&&t.set(s,n);return e.traverse(e=>{const s=i.associations.get(e);null!=s&&t.set(e,s)}),t})(n),n})}_createAnimationTracks(e,t,s,i,n){const o=[],r=e.name?e.name:e.uuid,a=[];let l;switch(Wt[n.path]===Wt.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(r),Wt[n.path]){case Wt.weights:l=be;break;case Wt.rotation:l=Te;break;case Wt.position:case Wt.scale:l=xe;break;default:if(1===s.itemSize)l=be;else l=xe}const c=void 0!==i.interpolation?Qt[i.interpolation]:le,h=this._getArrayFromAccessor(s);for(let d=0,u=a.length;d<u;d++){const e=new l(a[d]+"."+Wt[n.path],t.array,h,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),o.push(e)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=as(t.constructor),s=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)s[i]=t[i]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Te?Gt:Ut)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function hs(e,t,s){const n=t.attributes,o=[];function r(t,i){return s.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const i in n){const t=qt[i]||i.toLowerCase();t in e.attributes||o.push(r(n[i],t))}if(void 0!==t.indices&&!e.index){const i=s.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(i)}return ce.workingColorSpace!==L&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ce.workingColorSpace}" not supported.`),is(e,t),function(e,t,s){const n=t.attributes,o=new Ae;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new i(t[0],t[1],t[2]),new i(r[0],r[1],r[2])),e.normalized){const t=as(Vt[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new i,t=new i;for(let i=0,n=r.length;i<n;i++){const n=r[i];if(void 0!==n.POSITION){const i=s.json.accessors[n.POSITION],o=i.min,r=i.max;if(void 0!==o&&void 0!==r){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(r[2]))),i.normalized){const e=as(Vt[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const a=new Me;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}(e,t,s),Promise.all(o).then(function(){return void 0!==t.targets?function(e,t,s){let i=!1,n=!1,o=!1;for(let c=0,h=t.length;c<h;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(n=!0),void 0!==e.COLOR_0&&(o=!0),i&&n&&o)break}if(!i&&!n&&!o)return Promise.resolve(e);const r=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(i){const t=void 0!==h.POSITION?s.getDependency("accessor",h.POSITION):e.attributes.position;r.push(t)}if(n){const t=void 0!==h.NORMAL?s.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==h.COLOR_0?s.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l)]).then(function(t){const s=t[0],r=t[1],a=t[2];return i&&(e.morphAttributes.position=s),n&&(e.morphAttributes.normal=r),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,s):e})}class ds{mesh;position;radius;type;originalScale;originalMaterialProps;uniqueMaterial;selectionRing;selectionText;pulseAnimation;constructor(e,t,s=1){this.mesh=e,this.type=t,this.radius=s,this.position=new i,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.position.copy(this.position),this.originalScale=e.scale.clone()}setPosition(e){this.position.copy(e),this.mesh.position.copy(e)}getPosition(){return this.position.clone()}resetScale(){this.mesh.scale.copy(this.originalScale)}dispose(){this.mesh.geometry&&this.mesh.geometry.dispose(),this.mesh.material&&(Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose())}}const us={debug:!1,categories:[{id:"plants",displayName:"PLANTS",color:"#4CAF50",items:[{id:"grape_1",displayName:"Grape Plant 1",meshName:"grape_1",category:"plants",thumbnail:"/assets/images/grape.png",radius:1.5,scale:1},{id:"grape_2",displayName:"Grape Plant 2",meshName:"grape_2",category:"plants",thumbnail:"/assets/images/grape.png",radius:1.5,scale:1},{id:"grape_3",displayName:"Grape Plant 3",meshName:"grape_3",category:"plants",thumbnail:"/assets/images/grape.png",radius:1.5,scale:1},{id:"corn_1",displayName:"Corn Plant 1",meshName:"corn_1",category:"plants",thumbnail:"/assets/images/corn.png",radius:1.2,scale:1},{id:"corn_2",displayName:"Corn Plant 2",meshName:"corn_2",category:"plants",thumbnail:"/assets/images/corn.png",radius:1.2,scale:1},{id:"corn_3",displayName:"Corn Plant 3",meshName:"corn_3",category:"plants",thumbnail:"/assets/images/corn.png",radius:1.2,scale:1},{id:"strawberry_1",displayName:"Strawberry 1",meshName:"strawberry_1",category:"plants",thumbnail:"/assets/images/strawberry.png",radius:1,scale:1},{id:"strawberry_2",displayName:"Strawberry 2",meshName:"strawberry_2",category:"plants",thumbnail:"/assets/images/strawberry.png",radius:1,scale:1},{id:"strawberry_3",displayName:"Strawberry 3",meshName:"strawberry_3",category:"plants",thumbnail:"/assets/images/strawberry.png",radius:1,scale:1},{id:"tomato_1",displayName:"Tomato Plant 1",meshName:"tomato_1",category:"plants",thumbnail:"/assets/images/tomato.png",radius:1,scale:1},{id:"tomato_2",displayName:"Tomato Plant 2",meshName:"tomato_2",category:"plants",thumbnail:"/assets/images/tomato.png",radius:1,scale:1},{id:"tomato_3",displayName:"Tomato Plant 3",meshName:"tomato_3",category:"plants",thumbnail:"/assets/images/tomato.png",radius:1,scale:1}]},{id:"models",displayName:"MODELS",color:"#FF9800",items:[{id:"tree",displayName:"Tree",meshName:"tree",category:"models",thumbnail:"/assets/images/leaf.jpg",radius:2,scale:1},{id:"bench",displayName:"Garden Bench",meshName:"bench",category:"models",thumbnail:"/assets/images/leaf.jpg",radius:1.5,scale:1},{id:"fountain",displayName:"Fountain",meshName:"fountain",category:"models",thumbnail:"/assets/images/leaf.jpg",radius:2.5,scale:1},{id:"flower_pot",displayName:"Flower Pot",meshName:"flower_pot",category:"models",thumbnail:"/assets/images/leaf.jpg",radius:1,scale:1},{id:"lightpole",displayName:"Lightpole",meshName:"lightpole",category:"models",thumbnail:"data:image/svg+xml;base64,"+btoa('<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">\n            <rect width="64" height="64" fill="#f0f0f0" rx="8"/>\n            <rect x="28" y="45" width="4" height="12" fill="#666" rx="1"/>\n            <rect x="29" y="25" width="6" height="20" fill="#444" rx="1"/>\n            <circle cx="32" cy="22" r="6" fill="#ffeb3b" stroke="#ff9800" stroke-width="1"/>\n            <circle cx="32" cy="22" r="4" fill="#fff"/>\n            <path d="M32 16 L34 14 M32 16 L30 14 M26 22 L24 20 M26 22 L24 24 M38 22 L40 20 M38 22 L40 24" \n                  stroke="#ffeb3b" stroke-width="1" opacity="0.7"/>\n            <ellipse cx="32" cy="58" rx="8" ry="2" fill="#000" opacity="0.2"/>\n          </svg>'),radius:2,scale:1}]}]},ms=e=>us.categories.find(t=>t.id===e),gs=e=>{const t=ms(e);return t?t.items:[]},ps=()=>us.categories.flatMap(e=>e.items),fs=Object.freeze(Object.defineProperty({__proto__:null,UI_CONFIG:us,getAllItems:ps,getCategoryById:ms,getItemById:e=>{for(const t of us.categories){const s=t.items.find(t=>t.id===e);if(s)return s}},getItemsByCategory:gs},Symbol.toStringTag,{value:"Module"}));class ys{loader;loadedModels=new Map;assetDefinitions=[];constructor(){this.loader=new pt,this.generateAssetDefinitions(),this.preloadAssets()}generateAssetDefinitions(){const e=ps();this.assetDefinitions=e.map(e=>({type:e.id,category:e.category,modelPath:"/assets/gltf/objects.glb",thumbnailPath:e.thumbnail,radius:e.radius,scale:e.scale||1,gltfName:e.meshName}))}async preloadAssets(){const e=new Set;for(const s of this.assetDefinitions)s.modelPath&&e.add(s.modelPath);for(const s of e)try{await this.loadModelFile(s)}catch(t){}}async loadModelFile(e){return new Promise((t,s)=>{this.loader.load(e,s=>{this.loadedModels.set(e,s.scene),t()},void 0,s)})}countMeshesInScene(e){let t=0;return e.traverse(e=>{e instanceof d&&t++}),t}createItem(e){const t=this.assetDefinitions.find(t=>t.type===e);if(!t)return console.warn(`Unknown item type: ${e}`),null;let s;if("models"===t.category){const s=this.createProceduralModel(e);if(s)return new ds(s,e,t.radius)}if(t.modelPath){const i=this.loadedModels.get(t.modelPath);if(i){const n=i.clone();let o=null;if(t.gltfName&&n.traverse(e=>{e instanceof d&&!o&&(e.name!==t.gltfName&&e.parent?.name!==t.gltfName&&e.parent?.parent?.name!==t.gltfName||(o=e.clone()))}),o||n.traverse(e=>{}),!o){let e=null,t=0,s=0;n.traverse(i=>{i instanceof d&&s>t&&(t=s,e=i.clone()),s++}),e&&(o=e)}if(!o){const t=[e.toLowerCase(),e.replace("_",""),e.split("_")[0],"mesh","object","model"];n.traverse(e=>{if(e instanceof d&&!o){const s=(e.name||"").toLowerCase();for(const i of t)if(s.includes(i)){o=e.clone();break}}})}o?(s=o,t.scale&&s.scale.setScalar(t.scale),s.material&&(Array.isArray(s.material)?s.material.forEach(e=>{e instanceof Y&&(e.needsUpdate=!0)}):s.material.needsUpdate=!0)):s=this.createFallbackMesh(t)}else s=this.createFallbackMesh(t)}else s=this.createFallbackMesh(t),console.warn(` No model path specified for ${e}`);return new ds(s,e,t.radius)}createFallbackMesh(e){let t;switch(e.fallbackGeometry){case"box":default:t=new Pe(1,1,1);break;case"cylinder":t=new Le(.5,.5,1,8);break;case"sphere":t=new Ee(.5,16,16);break;case"cone":t=new Ie(.5,1,8)}const s=new q({color:e.fallbackMaterial?.color||8421504,roughness:e.fallbackMaterial?.roughness||.5,metalness:e.fallbackMaterial?.metalness||0}),i=new d(t,s);return e.scale&&i.scale.setScalar(e.scale),i}createProceduralModel(e){switch(e){case"tree":return this.createProceduralTree();case"bench":return this.createProceduralBench();case"fountain":return this.createProceduralFountain();case"flower_pot":return this.createProceduralFlowerPot();case"stone_path":return this.createProceduralStonePath();case"lightpole":return this.createProceduralLightpole(Math.random()*Math.PI*2);default:return console.warn(`Unknown procedural model type: ${e}`),null}}createProceduralTree(){const e=new q({color:9127187,roughness:.9,metalness:0}),t=new q({color:2263842,roughness:.8,metalness:0}),s=new ie,i=new d(new Le(.4,.6,3,8),e);i.position.y=1.5,i.castShadow=!0,i.receiveShadow=!0,s.add(i);const n=new d(new Ee(2.5,8,6),t);n.position.y=4.5,n.castShadow=!0,n.receiveShadow=!0,s.add(n);const o=new d(new Pe(5,6,5),new T({transparent:!0,opacity:0}));return o.userData.group=s,o.castShadow=!0,o.receiveShadow=!0,o}createProceduralBench(){const e=new q({color:9127187,roughness:.8,metalness:0}),t=new q({color:6908265,roughness:.3,metalness:.8}),s=new ie,i=new d(new Pe(3,.3,1.2),e);i.position.y=.65,i.castShadow=!0,i.receiveShadow=!0,s.add(i);const n=new d(new Pe(3,1.2,.2),e);n.position.set(0,1.25,-.6),n.castShadow=!0,n.receiveShadow=!0,s.add(n);[[-1.5,.325,0],[1.5,.325,0]].forEach(e=>{const i=new d(new Pe(.2,.65,.2),t);i.position.set(e[0],e[1],e[2]),i.castShadow=!0,i.receiveShadow=!0,s.add(i)});const o=new d(new Pe(3,1.5,1.2),new T({transparent:!0,opacity:0}));return o.userData.group=s,o.castShadow=!0,o.receiveShadow=!0,o}createProceduralFountain(){const e=new q({color:8421504,roughness:.8,metalness:0}),t=new q({color:4886754,roughness:.1,metalness:.8,transparent:!0,opacity:.7}),s=new ie,i=new d(new Le(2,2.5,.5,16),e);i.position.y=.25,i.castShadow=!0,i.receiveShadow=!0,s.add(i);const n=new d(new Le(.8,1.2,1.5,16),e);n.position.y=1.25,n.castShadow=!0,n.receiveShadow=!0,s.add(n);const o=new d(new Le(1.8,1.8,.3,16),t);o.position.y=.4,o.castShadow=!1,o.receiveShadow=!0,s.add(o);const r=new d(new Pe(5,2,5),new T({transparent:!0,opacity:0}));return r.userData.group=s,r.castShadow=!0,r.receiveShadow=!0,r}createProceduralFlowerPot(){const e=new q({color:13468991,roughness:.8,metalness:0}),t=new q({color:16738740,roughness:.7,metalness:0}),s=new ie,i=new d(new Le(.8,.6,1.2,8),e);i.position.y=.6,i.castShadow=!0,i.receiveShadow=!0,s.add(i);const n=new d(new Ee(.6,8,6),t);n.position.y=1.5,n.castShadow=!0,n.receiveShadow=!0,s.add(n);const o=new d(new Pe(1.6,2.1,1.6),new T({transparent:!0,opacity:0}));return o.userData.group=s,o.castShadow=!0,o.receiveShadow=!0,o}createProceduralStonePath(){const e=new q({color:9145227,roughness:.9,metalness:0}),t=new ie;for(let i=0;i<6;i++){const s=new d(new Pe(1.5,.3,1),e);s.position.set(1.8*(i-2.5),.15,0),s.rotation.y=.2*i,s.castShadow=!0,s.receiveShadow=!0,t.add(s)}const s=new d(new Pe(10.5,.3,2),new T({transparent:!0,opacity:0}));return s.userData.group=t,s.userData.pathLength=6,s.castShadow=!0,s.receiveShadow=!0,s}createProceduralLightpole(e=0){const t=new q({color:6908265,roughness:.7,metalness:.3}),s=new q({color:13421772,roughness:.2,metalness:.8,emissive:0,emissiveIntensity:0}),i=new ie,n=new d(new Le(.15,.2,6,8),t);n.position.y=3,n.castShadow=!0,n.receiveShadow=!0,i.add(n);const o=new d(new Ee(.4,8,6),s);o.position.y=6.2,o.castShadow=!0,o.receiveShadow=!0,i.add(o),i.rotation.y=e;const r=new d(new Pe(2,6.5,2),new T({transparent:!0,opacity:0}));return r.userData.group=i,r.castShadow=!0,r.receiveShadow=!0,r}createModelIcon(e){switch(e){case"tree":return this.createTreeIcon();case"bench":return this.createBenchIcon();case"fountain":return this.createFountainIcon();case"flower_pot":return this.createFlowerPotIcon();case"stone_path":return this.createStonePathIcon();case"lightpole":return this.createLightpoleIcon();default:return this.createDefaultIcon()}}createTreeIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Tree trunk --\x3e\n        <rect x="25" y="35" width="10" height="20" fill="#8B4513" rx="2"/>\n        \x3c!-- Tree leaves --\x3e\n        <circle cx="30" cy="25" r="15" fill="#228B22"/>\n        \x3c!-- Highlight --\x3e\n        <circle cx="27" cy="22" r="5" fill="#32CD32" opacity="0.7"/>\n      </svg>\n    '}createBenchIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Bench seat --\x3e\n        <rect x="10" y="35" width="40" height="8" fill="#8B4513" rx="2"/>\n        \x3c!-- Bench back --\x3e\n        <rect x="10" y="25" width="40" height="8" fill="#8B4513" rx="2"/>\n        \x3c!-- Bench legs --\x3e\n        <rect x="15" y="35" width="4" height="15" fill="#696969"/>\n        <rect x="41" y="35" width="4" height="15" fill="#696969"/>\n      </svg>\n    '}createFountainIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Fountain base --\x3e\n        <ellipse cx="30" cy="45" rx="20" ry="8" fill="#808080"/>\n        \x3c!-- Fountain center --\x3e\n        <ellipse cx="30" cy="35" rx="8" ry="12" fill="#808080"/>\n        \x3c!-- Water --\x3e\n        <ellipse cx="30" cy="42" rx="18" ry="6" fill="#4A90E2" opacity="0.7"/>\n        \x3c!-- Water drops --\x3e\n        <circle cx="25" cy="30" r="2" fill="#4A90E2"/>\n        <circle cx="35" cy="28" r="2" fill="#4A90E2"/>\n      </svg>\n    '}createFlowerPotIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Pot --\x3e\n        <ellipse cx="30" cy="45" rx="12" ry="8" fill="#CD853F"/>\n        \x3c!-- Flowers --\x3e\n        <circle cx="30" cy="25" r="12" fill="#FF69B4"/>\n        \x3c!-- Flower petals --\x3e\n        <circle cx="25" cy="20" r="6" fill="#FF1493"/>\n        <circle cx="35" cy="20" r="6" fill="#FF1493"/>\n        <circle cx="30" cy="15" r="6" fill="#FF1493"/>\n      </svg>\n    '}createStonePathIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Stone path pieces --\x3e\n        <rect x="5" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n        <rect x="20" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n        <rect x="35" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n        <rect x="50" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n        \x3c!-- Path direction indicator --\x3e\n        <polygon points="30,20 25,30 35,30" fill="#696969"/>\n      </svg>\n    '}createLightpoleIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        \x3c!-- Lightpole base --\x3e\n        <rect x="28" y="45" width="4" height="12" fill="#666" rx="1"/>\n        \x3c!-- Lightpole pole --\x3e\n        <rect x="29" y="25" width="6" height="20" fill="#444" rx="1"/>\n        \x3c!-- Light bulb --\x3e\n        <circle cx="32" cy="22" r="6" fill="#ffeb3b" stroke="#ff9800" stroke-width="1"/>\n        \x3c!-- Light glow --\x3e\n        <circle cx="32" cy="22" r="4" fill="#fff"/>\n        \x3c!-- Light rays --\x3e\n        <path d="M32 16 L34 14 M32 16 L30 14 M26 22 L24 20 M26 22 L24 24 M38 22 L40 20 M38 22 L40 24" \n              stroke="#ffeb3b" stroke-width="1" opacity="0.7"/>\n        \x3c!-- Ground shadow --\x3e\n        <ellipse cx="32" cy="58" rx="8" ry="2" fill="#000" opacity="0.2"/>\n      </svg>\n    '}createDefaultIcon(){return'\n      <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n        <rect x="15" y="15" width="30" height="30" fill="#CCCCCC" rx="5"/>\n        <text x="30" y="35" text-anchor="middle" fill="#666666" font-size="12">?</text>\n      </svg>\n    '}getAssetDefinitions(){return this.assetDefinitions}getAssetsByCategory(e){return this.assetDefinitions.filter(t=>t.category===e)}getThumbnailPath(e){const t=this.assetDefinitions.find(t=>t.type===e);return t?.thumbnailPath}debugLoadedModels(){console.log("=== Asset Manager Debug Info ==="),console.log("Asset Definitions:",this.assetDefinitions),console.log("Loaded Models:",this.loadedModels),console.log("Model Paths:",Array.from(this.loadedModels.keys()));for(const[e,t]of this.loadedModels.entries())console.log(`Model ${e}:`,{children:t.children.length,meshes:t.children.filter(e=>e instanceof d).length,groups:t.children.filter(e=>e instanceof ie).length,scene:t})}getDebugInfo(){return{assetDefinitions:this.assetDefinitions,loadedModelsCount:this.loadedModels.size,loadedModelPaths:Array.from(this.loadedModels.keys()),modelDetails:Array.from(this.loadedModels.entries()).map(([e,t])=>({path:e,childrenCount:t.children.length,meshCount:this.countMeshesInScene(t),groupCount:t.children.filter(e=>e instanceof ie).length}))}}getLoadedModelPaths(){return new Set(this.loadedModels.keys())}}class ws{onCategorySelect=null;onItemSelect=null;itemPanel;categoryButtons;activeCategory=null;constructor(){this.itemPanel=document.getElementById("item-panel"),this.categoryButtons=document.querySelectorAll(".category-button"),this.initializeEventListeners()}initializeEventListeners(){this.categoryButtons.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.category;t&&this.selectCategory(t)})})}selectCategory(e){if(this.activeCategory===e)return this.hideItemPanel(),this.activeCategory=null,this.categoryButtons.forEach(e=>{e.classList.remove("active")}),void console.log(` Toggled off category: ${e}`);this.categoryButtons.forEach(t=>{const s=t;s.dataset.category===e?s.classList.add("active"):s.classList.remove("active")}),this.activeCategory=e,this.showItemsForCategory(e),this.onCategorySelect&&this.onCategorySelect(e),console.log(` Switched to category: ${e}`)}showItemsForCategory(e){this.itemPanel.style.display="block",this.itemPanel.innerHTML="";const t=document.createElement("div");t.style.cssText="\n      color: #4CAF50;\n      font-size: 12px;\n      text-align: center;\n      margin-bottom: 10px;\n      padding: 8px;\n      background: rgba(76, 175, 80, 0.1);\n      border-radius: 6px;\n      border: 1px solid rgba(76, 175, 80, 0.3);\n    ",t.innerHTML="Click an item to start placing",this.itemPanel.appendChild(t);this.getItemsForCategory(e).forEach(e=>{const t=this.createItemButton(e);this.itemPanel.appendChild(t)})}updatePlacementStatus(e){const t=this.itemPanel.querySelector("div");t&&(t.innerHTML=e)}updateGnomeCounter(e,t){const s=document.getElementById("gnomes-found"),i=document.getElementById("total-gnomes");s&&(s.textContent=e.toString()),i&&(i.textContent=t.toString())}getItemsForCategory(e){return gs(e).map(e=>({type:e.id,name:e.displayName,thumbnail:e.thumbnail}))}createItemButton(e){const t=document.createElement("div");return t.className="item-button",t.dataset.itemType=e.type,e.thumbnail&&e.thumbnail.includes("leaf.jpg")?t.innerHTML=this.createCustomModelIcon(e.type,e.name):t.innerHTML=`\n        <img src="${e.thumbnail}" alt="${e.name}" />\n        <div class="label">${e.name}</div>\n      `,t.addEventListener("click",()=>{this.onItemSelect&&this.onItemSelect(e.type)}),t}createCustomModelIcon(e,t){switch(e){case"tree":return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              \x3c!-- Tree trunk --\x3e\n              <rect x="25" y="35" width="10" height="20" fill="#8B4513" rx="2"/>\n              \x3c!-- Tree leaves --\x3e\n              <circle cx="30" cy="25" r="15" fill="#228B22"/>\n              \x3c!-- Highlight --\x3e\n              <circle cx="27" cy="22" r="5" fill="#32CD32" opacity="0.7"/>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `;case"bench":return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              \x3c!-- Bench seat --\x3e\n              <rect x="10" y="35" width="40" height="8" fill="#8B4513" rx="2"/>\n              \x3c!-- Bench back --\x3e\n              <rect x="10" y="25" width="40" height="8" fill="#8B4513" rx="2"/>\n              \x3c!-- Bench legs --\x3e\n              <rect x="15" y="35" width="4" height="15" fill="#696969"/>\n              <rect x="41" y="35" width="4" height="15" fill="#696969"/>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `;case"fountain":return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              \x3c!-- Fountain base --\x3e\n              <ellipse cx="30" cy="45" rx="20" ry="8" fill="#808080"/>\n              \x3c!-- Fountain center --\x3e\n              <ellipse cx="30" cy="35" rx="8" ry="12" fill="#808080"/>\n              \x3c!-- Water --\x3e\n              <ellipse cx="30" cy="42" rx="18" ry="6" fill="#4A90E2" opacity="0.7"/>\n              \x3c!-- Water drops --\x3e\n              <circle cx="25" cy="30" r="2" fill="#4A90E2"/>\n              <circle cx="35" cy="28" r="2" fill="#4A90E2"/>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `;case"flower_pot":return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              \x3c!-- Pot --\x3e\n              <ellipse cx="30" cy="45" rx="12" ry="8" fill="#CD853F"/>\n              \x3c!-- Flowers --\x3e\n              <circle cx="30" cy="25" r="12" fill="#FF69B4"/>\n              \x3c!-- Flower petals --\x3e\n              <circle cx="25" cy="20" r="6" fill="#FF1493"/>\n              <circle cx="35" cy="20" r="6" fill="#FF1493"/>\n              <circle cx="30" cy="15" r="6" fill="#FF1493"/>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `;case"stone_path":return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              \x3c!-- Stone path pieces --\x3e\n              <rect x="5" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n              <rect x="20" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n              <rect x="35" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n              <rect x="50" y="25" width="12" height="8" fill="#8B8B8B" rx="2"/>\n              \x3c!-- Path direction indicator --\x3e\n              <polygon points="30,20 25,30 35,30" fill="#696969"/>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `;default:return`\n          <div class="custom-icon">\n            <svg width="50" height="50" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">\n              <rect x="15" y="15" width="30" height="30" fill="#CCCCCC" rx="5"/>\n              <text x="30" y="35" text-anchor="middle" fill="#666666" font-size="12">?</text>\n            </svg>\n            <div class="label">${t}</div>\n          </div>\n        `}}hideItemPanel(){this.itemPanel.style.display="none"}getActiveCategory(){return this.activeCategory}}class vs{dragState={isDragging:!1,itemType:null,dragElement:null,startPosition:{x:0,y:0},currentPosition:{x:0,y:0}};scene;camera;renderer;assetManager;gardenBounds;placedItems;raycaster;mouse;groundPlane;dragPreview=null;constructor(e,s,n,o,r,a){this.scene=e,this.camera=s,this.renderer=n,this.assetManager=o,this.gardenBounds=r,this.placedItems=a,this.raycaster=new Ce,this.mouse=new l,this.groundPlane=new t(new i(0,1,0),0),this.initializeEventListeners()}initializeEventListeners(){this.renderer.domElement.addEventListener("mousedown",this.onMouseDown.bind(this)),this.renderer.domElement.addEventListener("mousemove",this.onMouseMove.bind(this)),this.renderer.domElement.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("dragstart",this.onDragStart.bind(this)),document.addEventListener("dragend",this.onDragEnd.bind(this)),this.renderer.domElement.addEventListener("dragover",this.onDragOver.bind(this)),this.renderer.domElement.addEventListener("drop",this.onDrop.bind(this))}alignToGround(e){const t=(new Ae).setFromObject(e).min.y;e.position.y-=t}onDragStart(e){if(e.target instanceof HTMLElement){const t=e.target.closest(".item-button");if(t){const s=t.getAttribute("data-item-type");s&&this.startDrag(s,e)}}}onDragEnd(e){this.endDrag()}onDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"}onDrop(e){if(e.preventDefault(),this.dragState.isDragging&&this.dragState.itemType){const t=this.renderer.domElement.getBoundingClientRect(),s=e.clientX-t.left,n=e.clientY-t.top;this.mouse.x=s/t.width*2-1,this.mouse.y=-n/t.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const o=this.raycaster.ray.intersectPlane(this.groundPlane,new i);o&&this.isPositionValid(o)&&(this.wouldOverlap(o,this.dragState.itemType)||this.placeItem(this.dragState.itemType,o)),this.endDrag()}}startDrag(e,t){this.dragState.isDragging=!0,this.dragState.itemType=e,this.dragState.startPosition={x:t.clientX,y:t.clientY},this.dragState.currentPosition={x:t.clientX,y:t.clientY},this.createDragPreview(e),this.renderer.domElement.style.cursor="grabbing",t.preventDefault()}createDragPreview(e){const t=this.assetManager.createItem(e);t&&(this.dragPreview=t.mesh.clone(),this.alignToGround(this.dragPreview),this.dragPreview.material&&(Array.isArray(this.dragPreview.material)?this.dragPreview.material.forEach(e=>{e instanceof Y&&(e.transparent=!0,e.opacity=.6)}):(this.dragPreview.material.transparent=!0,this.dragPreview.material.opacity=.6)),this.scene.add(this.dragPreview))}onMouseDown(e){this.dragState.isDragging&&(this.renderer.domElement.style.cursor="grabbing")}onMouseMove(e){this.dragState.isDragging&&this.dragPreview&&this.updateDragPreview(e)}updateDragPreview(e){this.dragState.currentPosition={x:e.clientX,y:e.clientY},this.mouse.x=e.clientX/this.renderer.domElement.clientWidth*2-1,this.mouse.y=-e.clientY/this.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.ray.intersectPlane(this.groundPlane,new i);t&&(this.isPositionValid(t)?(this.dragPreview.position.copy(t),this.alignToGround(this.dragPreview),this.setPreviewColor(65280,.6)):this.setPreviewColor(16711680,.6))}onMouseUp(e){this.dragState.isDragging&&(this.placeDraggedItem(e),this.endDrag())}placeDraggedItem(e){if(!this.dragState.itemType)return;this.mouse.x=e.clientX/this.renderer.domElement.clientWidth*2-1,this.mouse.y=-e.clientY/this.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.ray.intersectPlane(this.groundPlane,new i);t&&this.isPositionValid(t)&&(this.wouldOverlap(t,this.dragState.itemType)||this.placeItem(this.dragState.itemType,t))}placeItem(e,t){const s=this.assetManager.createItem(e);s&&(this.alignToGround(s.mesh),s.position.copy(t),s.position.y=0,this.scene.add(s.mesh),this.placedItems.push(s),this.animateItemSpawn(s))}animateItemSpawn(e){e.mesh.scale.set(.6,.6,.6);const t=Date.now(),s=()=>{const i=Date.now()-t,n=Math.min(i/500,1),o=.6+.4*(1-Math.pow(1-n,3));e.mesh.scale.setScalar(o),n<1&&requestAnimationFrame(s)};s()}endDrag(){this.dragPreview&&(this.scene.remove(this.dragPreview),this.dragPreview=null),this.dragState.isDragging=!1,this.dragState.itemType=null,this.dragState.dragElement=null,this.renderer.domElement.style.cursor="default"}isPositionValid(e){return this.gardenBounds.containsPoint(e)}wouldOverlap(e,t){const s=this.assetManager.getAssetDefinitions().find(e=>e.type===t);if(!s)return!1;const i=s.radius;for(const n of this.placedItems){if(e.distanceTo(n.position)<i+n.radius)return!0}return!1}setPreviewColor(e,t){if(this.dragPreview&&this.dragPreview.material)if(Array.isArray(this.dragPreview.material))this.dragPreview.material.forEach(s=>{(s instanceof T||s instanceof q)&&(s.color.setHex(e),s.opacity=t)});else{const s=this.dragPreview.material;s.color.setHex(e),s.opacity=t}}updatePlacedItems(e){this.placedItems=e}destroy(){this.renderer.domElement.removeEventListener("mousedown",this.onMouseDown.bind(this)),this.renderer.domElement.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.renderer.domElement.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.dragPreview&&(this.scene.remove(this.dragPreview),this.dragPreview=null)}}class xs{scene;ambientLight;directionalLight;hemisphereLight;fog=null;isDay=!0;config;skybox=null;skyboxGeometry;skyboxMaterial;constructor(e,t,s,i){this.scene=e,this.ambientLight=t,this.directionalLight=s,this.hemisphereLight=i,this.config={day:{skyColor:11786751,ambientIntensity:.4,directionalIntensity:1.2,hemisphereIntensity:.5,fogColor:11786751,fogDensity:5e-4},night:{skyColor:726054,ambientIntensity:.2,directionalIntensity:.3,hemisphereIntensity:.1,fogColor:726054,fogDensity:.002}},this.skyboxGeometry=new Ee(500,32,32),this.createSkyboxMaterial(),this.createSkybox(),this.setDayMode()}createSkyboxMaterial(){this.skyboxMaterial=new g({uniforms:{topColor:{value:new x(30719)},bottomColor:{value:new x(16777215)},offset:{value:33},exponent:{value:.6}},vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() {\n          vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n          vWorldPosition = worldPosition.xyz;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 topColor;\n        uniform vec3 bottomColor;\n        uniform float offset;\n        uniform float exponent;\n        varying vec3 vWorldPosition;\n        void main() {\n          float h = normalize(vWorldPosition + offset).y;\n          gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), exponent), 0.0)), 1.0);\n        }\n      ",side:Re})}createSkybox(){this.skybox=new d(this.skyboxGeometry,this.skyboxMaterial),this.scene.add(this.skybox)}updateSkybox(){this.skybox&&(this.isDay?(this.skyboxMaterial.uniforms.topColor.value.setHex(11786751),this.skyboxMaterial.uniforms.bottomColor.value.setHex(15792383),this.skyboxMaterial.uniforms.exponent.value=.8):(this.skyboxMaterial.uniforms.topColor.value.setHex(726054),this.skyboxMaterial.uniforms.bottomColor.value.setHex(0),this.skyboxMaterial.uniforms.exponent.value=1.2))}toggleDayNight(){this.isDay=!this.isDay,this.isDay?this.setDayMode():this.setNightMode(),console.log(` Switched to ${this.isDay?"day":"night"} mode`)}setDayMode(){this.isDay=!0;const e=this.config.day;this.scene.background=new x(e.skyColor),this.ambientLight.intensity=e.ambientIntensity,this.directionalLight.intensity=e.directionalIntensity,this.hemisphereLight.intensity=e.hemisphereIntensity,this.fog&&this.fog.color.setHex(e.fogColor),this.updateSkybox(),this.directionalLight.position.set(40,80,40),this.directionalLight.color.setHex(16774374),this.hemisphereLight.color.setHex(11786751),this.hemisphereLight.groundColor.setHex(16052702)}setNightMode(){this.isDay=!1;const e=this.config.night;this.scene.background=new x(e.skyColor),this.ambientLight.intensity=e.ambientIntensity,this.directionalLight.intensity=e.directionalIntensity,this.hemisphereLight.intensity=e.hemisphereIntensity,this.fog&&this.fog.color.setHex(e.fogColor),this.updateSkybox(),this.directionalLight.position.set(-30,80,-30),this.directionalLight.color.setHex(15132410)}getCurrentMode(){return this.isDay?"day":"night"}updateLightpoleBulb(e,t,s){this.isDay?(t.color.setHex(13421772),t.emissive.setHex(0),t.emissiveIntensity=0,s&&(s.intensity=0)):(t.color.setHex(16777130),t.emissive.setHex(16777130),t.emissiveIntensity=.8,s&&(s.intensity=1.5,s.color.setHex(16777130)))}addFogToScene(){const e=this.isDay?this.config.day:this.config.night;this.fog=new De(e.fogColor,100,1e3),this.scene.fog=this.fog}removeFogFromScene(){this.scene.fog=null,this.fog=null}updateLighting(e){this.ambientLight.intensity=this.config.day.ambientIntensity*e,this.directionalLight.intensity=this.config.day.directionalIntensity*e,this.hemisphereLight.intensity=this.config.day.hemisphereIntensity*e}destroy(){this.skybox&&(this.scene.remove(this.skybox),this.skybox.geometry.dispose(),this.skybox.material&&(Array.isArray(this.skybox.material)?this.skybox.material.forEach(e=>e.dispose()):this.skybox.material.dispose()),this.skybox=null),this.fog&&(this.scene.fog=null,this.fog=null)}}class bs{themeAudio=null;clickAudio=null;isThemePlaying=!1;volume=.3;constructor(){this.initializeAudio()}initializeAudio(){try{this.themeAudio=new Audio("/assets/sounds/theme.mp3"),this.themeAudio.loop=!0,this.themeAudio.volume=this.volume,this.themeAudio.preload="auto",this.clickAudio=new Audio("/assets/sounds/click_003.mp3"),this.clickAudio.volume=.5*this.volume,this.clickAudio.preload="auto",console.log(" Audio initialized successfully")}catch(e){console.error(" Error initializing audio:",e)}}playTheme(){this.themeAudio&&!this.isThemePlaying&&this.themeAudio.play().then(()=>{this.isThemePlaying=!0,console.log(" Theme music started")}).catch(e=>{console.error(" Error playing theme music:",e)})}stopTheme(){this.themeAudio&&this.isThemePlaying&&(this.themeAudio.pause(),this.themeAudio.currentTime=0,this.isThemePlaying=!1,console.log(" Theme music stopped"))}toggleTheme(){this.isThemePlaying?this.stopTheme():this.playTheme()}playClick(){this.clickAudio&&(this.clickAudio.currentTime=0,this.clickAudio.play().catch(e=>{console.error(" Error playing click sound:",e)}))}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.themeAudio&&(this.themeAudio.volume=this.volume),this.clickAudio&&(this.clickAudio.volume=.5*this.volume),console.log(` Volume set to: ${Math.round(100*this.volume)}%`)}getVolume(){return this.volume}isThemeActive(){return this.isThemePlaying}destroy(){this.themeAudio&&(this.themeAudio.pause(),this.themeAudio.src="",this.themeAudio=null),this.clickAudio&&(this.clickAudio.pause(),this.clickAudio.src="",this.clickAudio=null),this.isThemePlaying=!1,console.log(" Audio manager destroyed")}}class Ts{scene;camera;renderer;composer;controls;assetManager;uiManager;dragAndDropManager;dayNightSystem;audioManager;gardenPlane;gardenBounds;gridHelper;placedItems=[];previewItem=null;raycaster;mouse;isPlacing=!1;selectedItemType=null;selectedItem=null;isDragging=!1;dragOffset=new i;capturedLogs=[];lightpoleBulb=null;lightpoleBulbMaterial=null;lightpoleLight=null;totalGnomes=8;foundGnomes=0;constructor(){this.initializeScene(),this.initializeCamera(),this.initializeRenderer(),this.initializePostProcessing(),this.initializeControls(),this.initializeGarden(),this.initializeAssetManager(),this.initializeUI(),this.initializeEventListeners(),this.animate()}initializeScene(){this.scene=new _e,this.scene.background=new x(11786751);const e=new Ne(16774374,.4);this.scene.add(e);const t=new D(16774374,1.2);t.position.set(40,80,40),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=500,t.shadow.camera.left=-100,t.shadow.camera.right=100,t.shadow.camera.top=100,t.shadow.camera.bottom=-100,this.scene.add(t);const s=new Be(11786751,16052702,.5);this.scene.add(s),this.dayNightSystem=new xs(this.scene,e,t,s)}initializeCamera(){this.camera=new ne(60,1920/1080,.1,1e3),this.camera.position.set(30,25,30),this.camera.lookAt(0,0,0)}initializeRenderer(){const e=document.getElementById("canvas-container");if(!e)throw new Error("Canvas container not found");this.renderer=new ke({antialias:!0,alpha:!0}),this.renderer.setSize(1920,1080),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Oe,this.renderer.toneMapping=Fe,this.renderer.toneMappingExposure=1,this.renderer.outputColorSpace=_,e.appendChild(this.renderer.domElement)}initializePostProcessing(){this.composer=new ht(this.renderer);const e=new dt(this.scene,this.camera);this.composer.addPass(e);const t=new mt(new l(1920,1080),.5,.4,.85);this.composer.addPass(t)}initializeControls(){this.controls=new tt(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.minDistance=15,this.controls.maxDistance=80,this.controls.minPolarAngle=Math.PI/6,this.controls.maxPolarAngle=Math.PI/2.5,this.controls.maxAzimuthAngle=Math.PI/2,this.controls.minAzimuthAngle=-Math.PI/2}showGrid(){this.gridHelper&&(this.gridHelper.visible=!0)}hideGrid(){this.gridHelper&&(this.gridHelper.visible=!1)}initializeGarden(){const e=new He(40,30),t=new q({color:8172354,roughness:.9,metalness:0});this.gardenPlane=new d(e,t),this.gardenPlane.rotation.x=-Math.PI/2,this.gardenPlane.receiveShadow=!0,this.scene.add(this.gardenPlane),this.gardenBounds=new Ae(new i(-20,-.1,-15),new i(20,.1,15)),this.gridHelper=new je(40,40,6710886,4473924),this.gridHelper.position.y=.01,this.gridHelper.visible=!1,this.scene.add(this.gridHelper),this.createSurroundingElements()}showLoadingStatus(){const e=document.createElement("div");e.id="loading-status",e.style.cssText="\n      position: absolute;\n      top: 20px;\n      right: 20px;\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-family: Arial, sans-serif;\n      font-size: 14px;\n      z-index: 1000;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    ",e.innerHTML=" Loading 3D Models...",document.getElementById("ui-overlay")?.appendChild(e),setTimeout(()=>{e.innerHTML=" 3D Models Loaded!",e.style.background="rgba(76, 175, 80, 0.9)",e.style.borderColor="rgba(76, 175, 80, 0.3)",setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s ease-out",setTimeout(()=>e.remove(),500)},3e3)},3e3)}setupConsoleCapture(){const e=console.log,t=console.warn,s=console.error;this.capturedLogs=[],console.log=(...t)=>{this.capturedLogs.push({type:"log",timestamp:(new Date).toISOString(),args:t}),e.apply(console,t)},console.warn=(...e)=>{this.capturedLogs.push({type:"warn",timestamp:(new Date).toISOString(),args:e}),t.apply(console,e)},console.error=(...e)=>{this.capturedLogs.push({type:"error",timestamp:(new Date).toISOString(),args:e}),s.apply(console,e)}}createSurroundingElements(){this.createHedgeWalls()}createHedgeWalls(){const e=new q({color:3046706,roughness:.9,metalness:0}),t=new d(new Pe(42,2.5,1.2),e);t.position.set(0,1.25,-15.5),t.castShadow=!0,this.scene.add(t);const s=new d(new Pe(42,2.5,1.2),e);s.position.set(0,1.25,15.5),s.castShadow=!0,this.scene.add(s);const i=new d(new Pe(1.2,2.5,32),e);i.position.set(20.5,1.25,0),i.castShadow=!0,this.scene.add(i);const n=new d(new Pe(1.2,2.5,32),e);n.position.set(-20.5,1.25,0),n.castShadow=!0,this.scene.add(n)}initializeAssetManager(){this.assetManager=new ys,this.dragAndDropManager=new vs(this.scene,this.camera,this.renderer,this.assetManager,this.gardenBounds,this.placedItems),this.audioManager=new bs,setTimeout(()=>{this.assetManager.debugLoadedModels(),this.addPrePlacedGardenItems()},3e3)}addPrePlacedGardenItems(){this.addProceduralGardenItems(),this.tryLoadGLTFModels()}addProceduralGardenItems(){this.createProceduralTree(-18,0,-13,0),this.createProceduralTree(18,0,-13,0),this.createProceduralBench(-13,0,-13,0),this.createProceduralBench(-6,0,-13,0),this.createProceduralBench(-18,0,-8.5,Math.PI/2),this.createProceduralBench(-18,0,-1,Math.PI/2),this.createProceduralBench(13,0,-13,0),this.createProceduralBench(6,0,-13,0),this.createProceduralBench(18,0,-8.5,-Math.PI/2),this.createProceduralBench(18,0,-1,-Math.PI/2),this.createProceduralLightpole(-9.5,0,-13,0),this.createProceduralLightpole(-18,0,-4.75,0),this.createProceduralLightpole(9.5,0,-13,0),this.createProceduralLightpole(18,0,-4.75,0),this.createProceduralLightpole(9.5,0,13,0),this.createProceduralLightpole(-9.5,0,13,0),this.createProceduralFlowerPot(-18,0,2.5,.6*Math.PI),this.createProceduralFlowerPot(-2,0,-13,.3*Math.PI),this.createProceduralFlowerPot(18,0,2.5,-.6*Math.PI),this.createProceduralFlowerPot(2,0,-13,-.3*Math.PI),this.integratePrePlacedLightpoles(),this.createProceduralStonePath(-9,0,-11,0,9),this.createProceduralStonePath(9,0,-11,Math.PI,9),this.createProceduralStonePath(0,0,-4.5,0,7),this.createProceduralStonePath(0,0,14,0,11),this.createProceduralStonePath(-13,0,5,0,7),this.createProceduralStonePath(13,0,5,Math.PI,7),this.createProceduralStonePath(7,0,-.4,Math.PI/2,5),this.createProceduralStonePath(-7,0,-.4,-Math.PI/2,5),this.createProceduralStonePath(-10.5,0,10,Math.PI/2,5),this.createProceduralStonePath(10.5,0,10,-Math.PI/2,5),this.createProceduralStonePath(-16,0,-3,Math.PI/2,8),this.createProceduralStonePath(16,0,-3,-Math.PI/2,8),this.createProceduralStonePath(0,0,-10,Math.PI/2,5),this.createProceduralHouse(-15,0,10,0),this.createProceduralHouse(15,0,10,Math.PI),this.createProceduralGnome(16,0,-13,0,0,0),this.createProceduralGnome(18,-.1,2.5,0,-Math.PI/2,0),this.createProceduralGnome(-15.5,0,-13,0,Math.PI/2,0),this.createProceduralGnome(-12,1,-13,Math.PI/2,0,Math.PI/2),this.createProceduralGnome(-16,3,14.5,Math.PI/2,.5,Math.PI),this.createWalkingGnome(-15.5,0,5,Math.PI/2,8,0,.006),this.createWalkingGnome(7,0,-4,0,9,Math.PI/2,.003),this.createWalkingGnome(15,0,-11,-Math.PI/2,31.5,Math.PI,.001)}createProceduralTree(e,t,s,i=0){const n=new q({color:9127187,roughness:.9,metalness:0}),o=new q({color:2263842,roughness:.8,metalness:0}),r=new ie;r.position.set(e,0,s),r.rotation.y=i,this.scene.add(r);const a=new d(new Le(.4,.6,3,8),n);a.position.set(0,1.5,0),a.castShadow=!0,a.receiveShadow=!0,r.add(a);const l=new d(new Ee(2.5,8,6),o);l.position.set(0,4.5,0),l.castShadow=!0,l.receiveShadow=!0,r.add(l)}createProceduralBench(e,t,s,i=0){const n=new q({color:9127187,roughness:.8,metalness:0}),o=new q({color:6908265,roughness:.3,metalness:.8}),r=new ie;r.position.set(e,0,s),r.rotation.y=i,this.scene.add(r);const a=new d(new Pe(3,.3,1.2),n);a.position.set(0,.65,0),a.castShadow=!0,a.receiveShadow=!0,r.add(a);const l=new d(new Pe(3,1.2,.2),n);l.position.set(0,1.25,-.5),l.castShadow=!0,l.receiveShadow=!0,r.add(l);[[-1,.325,0],[1,.325,0]].forEach(e=>{const t=new d(new Pe(.2,.65,.2),o);t.position.set(e[0],e[1],e[2]),t.castShadow=!0,t.receiveShadow=!0,r.add(t)})}createProceduralLightpole(e,t,s,i=0){const n=new q({color:6908265,roughness:.7,metalness:.3}),o=new q({color:13421772,roughness:.2,metalness:.8,emissive:0,emissiveIntensity:0}),r=new ie;r.position.set(e,0,s),r.rotation.y=i,r.userData.isLightpole=!0,this.scene.add(r);const a=new d(new Le(.15,.2,6,8),n);a.position.set(0,3,0),a.castShadow=!0,a.receiveShadow=!0,r.add(a);const l=new d(new Ee(.4,8,6),o);l.position.set(0,6.2,0),l.castShadow=!0,l.receiveShadow=!0,r.add(l);const c=new R(16777130,0,15,2);c.position.set(e,6.2,s),c.castShadow=!0,c.shadow.mapSize.width=1024,c.shadow.mapSize.height=1024,c.shadow.camera.near=.1,c.shadow.camera.far=20,c.shadow.camera.fov=90,this.scene.add(c),this.lightpoleBulb=l,this.lightpoleBulbMaterial=o,this.lightpoleLight=c}integratePrePlacedLightpoles(){this.scene.traverse(e=>{e instanceof ie&&e.userData.isLightpole&&this.setupPrePlacedLightpole(e)})}setupPrePlacedLightpole(e){let t=null,s=null;if(e.traverse(e=>{e instanceof d&&e.geometry instanceof Ee&&(t=e,e.material instanceof q&&(s=e.material))}),t&&s){const i=new R(16777130,0,15,2);if(i.position.copy(e.position),i.position.y=6.2,i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.camera.near=.1,i.shadow.camera.far=20,i.shadow.camera.fov=90,this.scene.add(i),e.userData.lightpoleBulb=t,e.userData.lightpoleBulbMaterial=s,e.userData.lightpoleLight=i,this.dayNightSystem){"night"===this.dayNightSystem.getCurrentMode()?(s.color.setHex(16777130),s.emissive.setHex(16777130),s.emissiveIntensity=.8,i.intensity=1.5):(s.color.setHex(13421772),s.emissive.setHex(0),s.emissiveIntensity=0,i.intensity=0)}}else console.warn(" Could not find bulb mesh or material in pre-placed lightpole")}createProceduralFlowerPot(e,t,s,i=0){const n=new q({color:13468991,roughness:.8,metalness:0}),o=new q({color:9127187,roughness:.9,metalness:0}),r=new q({color:16738740,roughness:.3,metalness:0}),a=new ie;a.position.set(e,0,s),a.rotation.y=i,this.scene.add(a);const l=new d(new Le(.8,.6,1.2,8),n);l.position.set(0,.6,0),l.castShadow=!0,l.receiveShadow=!0,a.add(l);const c=new d(new Le(.7,.7,.3,8),o);c.position.set(0,1.05,0),c.castShadow=!0,c.receiveShadow=!0,a.add(c);[[0,1.4,0],[-.3,1.3,.2],[.3,1.3,-.2],[.2,1.4,.3],[-.2,1.4,-.3]].forEach(e=>{const t=new d(new Ee(.15,6,4),r);t.position.set(e[0],e[1],e[2]),t.castShadow=!0,t.receiveShadow=!0,a.add(t)});const h=[16716947,16738740,16758465,16761035,14381203];a.children.forEach((e,t)=>{if(e instanceof d&&e.geometry instanceof Ee&&t>1){e.material.color.setHex(h[t-2])}})}createProceduralStonePath(e,t,s,i=0,n=6){const o=new q({color:9145227,roughness:.9,metalness:0}),r=new ie;r.position.set(e,-.2,s),r.rotation.y=i,this.scene.add(r);const a=n;for(let l=0;l<a;l++){const e=new d(new Pe(1.5,.3,1),o),t=1.8*(l-(a-1)/2),s=.15,i=0;e.position.set(t,s,i);const n=.4*(Math.random()-.5);e.rotation.y=n,e.castShadow=!0,e.receiveShadow=!0,r.add(e)}}createProceduralHouse(e,t,s,n=0){(new pt).load("/assets/gltf/cottage.glb",o=>{const r=o.scene;let a=null;if(r.traverse(e=>{e instanceof d&&!a&&(a=e)}),!a)return void console.warn(" No mesh found in cottage.glb");const l=a.clone();l.castShadow=!0,l.receiveShadow=!0,l.geometry.computeBoundingBox();const c=l.geometry.boundingBox,h=new i;c.getSize(h);const u=new i;c.getCenter(u),l.geometry.translate(-u.x,-c.min.y,-u.z),l.scale.setScalar(.75);const m=new ds(l,"cottage",2);m.mesh.position.set(e,t,s),m.mesh.rotation.set(0,n,0),m.originalScale.copy(l.scale),l.isSelected=!1,l.userData.onSelect=()=>{l.isSelected=!0},l.userData.onDeselect=()=>{l.isSelected=!1,m.resetScale()};const g=m.originalScale.clone();let p=0;const f=()=>{if(l.isSelected){p+=.05;const e=1+.05*Math.sin(5*p);l.scale.set(g.x*e,g.y*e,g.z*e)}requestAnimationFrame(f)};f(),this.scene.add(m.mesh),this.placedItems.push(m),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems)},void 0,e=>console.error(" Failed to load cottage.glb:",e))}createProceduralGnome(e,t,s,n=0,o=0,r=0){(new pt).load("/assets/gltf/gnome.glb",a=>{const l=a.scene;let c=null;if(l.traverse(e=>{e instanceof d&&!c&&(c=e)}),!c)return void console.warn(" No mesh found in gnome.glb");const h=c.clone();h.castShadow=!0,h.receiveShadow=!0,h.geometry.computeBoundingBox();const u=h.geometry.boundingBox,m=new i;u.getSize(m);const g=new i;u.getCenter(g),h.geometry.translate(-g.x,-u.min.y,-g.z);h.scale.setScalar(.075);const p=new ds(h,"gnome",1);p.mesh.position.set(e,t,s),p.mesh.rotation.set(n,o,r),p.originalScale.copy(h.scale),h.isSelected=!1,h.userData.isGnome=!0,h.userData.onSelect=()=>{h.isSelected=!0},h.userData.onDeselect=()=>{h.isSelected=!1,p.resetScale()};const f=p.originalScale.clone();let y=0;const w=()=>{if(h.isSelected){y+=.05;const e=1+.05*Math.sin(5*y);h.scale.set(f.x*e,f.y*e,f.z*e)}requestAnimationFrame(w)};w(),this.scene.add(p.mesh),this.placedItems.push(p),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems)},void 0,e=>console.error(" Failed to load gnome.glb:",e))}createWalkingGnome(e,t,s,n=0,o=8,r=0,a=45e-5){(new pt).load("/assets/gltf/gnome.glb",l=>{const c=l.scene;let h=null;if(c.traverse(e=>{e instanceof d&&!h&&(h=e)}),!h)return void console.warn(" No mesh found in gnome.glb");const u=h.clone();u.castShadow=!0,u.receiveShadow=!0,u.geometry.computeBoundingBox();const m=u.geometry.boundingBox,g=new i;m.getSize(g);const p=new i;m.getCenter(p),u.geometry.translate(-p.x,-m.min.y,-p.z);u.scale.setScalar(.075);const f=new ds(u,"gnome",1);f.mesh.position.set(e,t,s),f.mesh.rotation.set(0,n,0),f.originalScale.copy(u.scale),u.isSelected=!1,u.userData.isGnome=!0,u.userData.onSelect=()=>{u.isSelected=!0},u.userData.onDeselect=()=>{u.isSelected=!1,f.resetScale()};const y=f.originalScale.clone();let w=0;const v=()=>{if(u.isSelected){w+=.05;const e=1+.05*Math.sin(5*w);u.scale.set(y.x*e,y.y*e,y.z*e)}requestAnimationFrame(v)};v();const x=e;let b=x,T=1;const A=()=>{b+=a*T*o,b>=x+o?(T=-1,b=x+o,u.rotation.y=n+Math.PI):b<=x&&(T=1,b=x,u.rotation.y=n);const e=x+(b-x)*Math.cos(r),i=s+(b-x)*Math.sin(r);u.position.x=e,u.position.z=i;const l=(b-x)/o;u.position.y=t+.1*Math.abs(Math.sin(l*Math.PI*8)),requestAnimationFrame(A)};A(),this.scene.add(f.mesh),this.placedItems.push(f),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems)},void 0,e=>console.error(" Failed to load gnome.glb:",e))}updateLightpoleBulb(){this.lightpoleBulb&&this.lightpoleBulbMaterial&&this.lightpoleLight&&this.dayNightSystem&&this.dayNightSystem.updateLightpoleBulb(this.lightpoleBulb,this.lightpoleBulbMaterial,this.lightpoleLight),this.scene.traverse(e=>{e instanceof ie&&e.userData.isLightpole&&e.userData.lightpoleBulb&&e.userData.lightpoleBulbMaterial&&e.userData.lightpoleLight&&this.dayNightSystem&&this.dayNightSystem.updateLightpoleBulb(e.userData.lightpoleBulb,e.userData.lightpoleBulbMaterial,e.userData.lightpoleLight)}),this.placedItems.forEach(e=>{"lightpole"===e.type&&e.mesh.userData.lightpoleBulb&&e.mesh.userData.lightpoleBulbMaterial&&e.mesh.userData.lightpoleLight&&this.dayNightSystem&&this.dayNightSystem.updateLightpoleBulb(e.mesh.userData.lightpoleBulb,e.mesh.userData.lightpoleBulbMaterial,e.mesh.userData.lightpoleLight)})}setupPlacedLightpole(e){let t=null,s=null;if(e.mesh.userData.group){e.mesh.userData.group.traverse(e=>{e instanceof d&&e.geometry instanceof Ee&&(t=e,e.material instanceof q&&(s=e.material))})}if(t&&s){const i=new R(16777130,0,15,2);if(i.position.copy(e.position),i.position.y=6.2,i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.camera.near=.1,i.shadow.camera.far=20,i.shadow.camera.fov=90,this.scene.add(i),e.mesh.userData.lightpoleBulb=t,e.mesh.userData.lightpoleBulbMaterial=s,e.mesh.userData.lightpoleLight=i,this.dayNightSystem){"night"===this.dayNightSystem.getCurrentMode()?(s.color.setHex(16777130),s.emissive.setHex(16777130),s.emissiveIntensity=.8,i.intensity=1.5):(s.color.setHex(13421772),s.emissive.setHex(0),s.emissiveIntensity=0,i.intensity=0)}}else console.warn(" Could not find bulb mesh or material in placed lightpole")}tryLoadGLTFModels(){}initializeUI(){this.uiManager=new ws,this.uiManager.onCategorySelect=e=>{this.uiManager.showItemsForCategory(e)},this.uiManager.onItemSelect=e=>{this.selectedItemType=e,this.audioManager&&this.audioManager.playClick(),this.startPlacingItem(e)},this.showLoadingStatus(),this.updateGnomeCounter(),this.setupDebugButtons()}initializeEventListeners(){this.raycaster=new Ce,this.mouse=new l,this.setupConsoleCapture(),this.renderer.domElement.addEventListener("mousemove",e=>{this.onMouseMove(e)}),this.renderer.domElement.addEventListener("click",e=>{this.onMouseClick(e)}),this.renderer.domElement.addEventListener("mouseup",e=>{this.onMouseUp(e)}),this.renderer.domElement.addEventListener("contextmenu",e=>{e.preventDefault(),this.cancelPlacement()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(this.isPlacing?this.cancelPlacement():this.selectedItem&&this.deselectItem()),"Delete"===e.key&&this.selectedItem&&this.deleteSelectedItem()}),window.addEventListener("resize",()=>{this.onWindowResize()})}onMouseMove(e){const t=this.renderer.domElement.getBoundingClientRect();if(this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-(e.clientY-t.top)/t.height*2+1,this.isDragging&&this.selectedItem){this.raycaster.setFromCamera(this.mouse,this.camera);const e=this.raycaster.intersectObject(this.gardenPlane);if(e.length>0){const t=e[0].point;if(this.selectedItem.position.copy(t),this.selectedItem.position.y=0,this.selectedItem.mesh.position.copy(this.selectedItem.position),this.selectedItem.mesh.userData.group){const e=this.selectedItem.mesh.userData.group;e.position.copy(t),e.position.y=0,console.log(" Dragg ing group item - Item pos:",this.selectedItem.position,"Group pos:",e.position)}else console.log(" Dragging single mesh item - Item pos:",this.selectedItem.position,"Mesh pos:",this.selectedItem.mesh.position);if(this.selectedItem.selectionRing&&(this.selectedItem.selectionRing.position.copy(t),this.selectedItem.selectionRing.position.y=.01),this.selectedItem.selectionText)if(this.selectedItem.selectionText.position.copy(t),this.selectedItem.mesh.userData.group){const e=this.selectedItem.mesh.userData.group,t=(new Ae).setFromObject(e);this.selectedItem.selectionText.position.y=t.max.y+.5}else this.selectedItem.selectionText.position.y=this.selectedItem.mesh.geometry.boundingBox?.max.y||2}}}onMouseClick(e){const t=this.renderer.domElement.getBoundingClientRect();if(this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-(e.clientY-t.top)/t.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera),this.isPlacing&&this.previewItem&&this.selectedItemType){const e=this.raycaster.intersectObject(this.gardenPlane);if(e.length>0){const t=e[0].point,s=this.assetManager.createItem(this.selectedItemType);if(s){if(!this.isPositionValid(t))return void console.log(` Position not valid for ${this.selectedItemType} at:`,t);if(this.wouldOverlap(t,s.radius))return void console.log(` Overlap detected for ${this.selectedItemType} at:`,t);if(s.position.copy(t),s.position.y=0,s.mesh.position.copy(t),s.mesh.position.y=0,s.originalScale=s.mesh.scale.clone(),this.ensureCleanMaterials(s),s.mesh.userData.group){const e=s.mesh.userData.group;e.position.copy(t),e.position.y=0,this.scene.add(e),s.mesh.position.copy(t),s.mesh.position.y=0}else this.scene.add(s.mesh);this.placedItems.push(s),"lightpole"===this.selectedItemType&&this.setupPlacedLightpole(s),this.animateItemSpawn(s),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems)}else console.error(" Failed to create item for placement");this.cancelPlacement()}}else this.selectItemAtMouse()}onMouseUp(e){if(this.isDragging&&this.selectedItem){if(this.isDragging=!1,this.isPositionValid(this.selectedItem.position)){if(this.selectedItem.mesh.userData.group){const e=this.selectedItem.mesh.userData.group;e.position.copy(this.selectedItem.position),e.position.y=0}}else if(this.selectedItem.position.copy(this.selectedItem.mesh.position),this.selectedItem.mesh.userData.group){const e=this.selectedItem.mesh.userData.group;e.position.copy(this.selectedItem.position),e.position.y=0}this.deselectItem()}}selectItemAtMouse(){const e=[],t=new Map;this.placedItems.forEach(s=>{if(e.push(s.mesh),t.set(s.mesh,s),s.mesh.userData.group){s.mesh.userData.group.traverse(i=>{i instanceof d&&(e.push(i),t.set(i,s))})}});const s=this.raycaster.intersectObjects(e,!0);if(s.length>0){const e=s[0].object,i=t.get(e);if(i){if(e.userData.isGnome)return void this.makeGnomeDisappear(i,e);this.selectedItem===i?this.deselectItem():this.selectItem(i)}}else this.deselectItem()}selectItem(e){this.selectedItem&&this.deselectItem(),this.selectedItem=e,this.highlightItem(e),this.startDragging(e)}deselectItem(){this.selectedItem&&(this.removeHighlight(this.selectedItem),this.selectedItem=null,this.isDragging=!1,console.log(" Item deselected"))}highlightItem(e){if(e.mesh.material){const t=Array.isArray(e.mesh.material)?e.mesh.material[0]:e.mesh.material;t instanceof q&&(e.originalMaterialProps||(e.originalMaterialProps={emissive:t.emissive.clone(),emissiveIntensity:t.emissiveIntensity,color:t.color.clone()},console.log(` Stored original material props for: ${e.type}`,{emissive:e.originalMaterialProps.emissive.getHexString(),emissiveIntensity:e.originalMaterialProps.emissiveIntensity,color:e.originalMaterialProps.color.getHexString()})),e.uniqueMaterial||(e.uniqueMaterial=t.clone(),e.mesh.material=e.uniqueMaterial),e.uniqueMaterial.emissive.setHex(26367),e.uniqueMaterial.emissiveIntensity=.6,console.log(` Applied highlighting to: ${e.type}`,{newEmissive:e.uniqueMaterial.emissive.getHexString(),newEmissiveIntensity:e.uniqueMaterial.emissiveIntensity}))}if(this.addSelectionRing(e),this.startPulseAnimation(e),this.addSelectionText(e),e.mesh.userData.group){e.mesh.userData.group.traverse(e=>{if(e instanceof d&&e.material){const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof q&&(e.userData.originalMaterial||(e.userData.originalMaterial={emissive:t.emissive.clone(),emissiveIntensity:t.emissiveIntensity,color:t.color.clone()}),t.emissive.setHex(26367),t.emissiveIntensity=.4)}}),console.log(` Group highlighting applied to: ${e.type}`)}console.log(` Enhanced highlighting applied to: ${e.type}`)}removeHighlight(e){if(e.mesh.material){const t=Array.isArray(e.mesh.material)?e.mesh.material[0]:e.mesh.material;t instanceof q&&e.originalMaterialProps?(console.log(` Restoring material for: ${e.type}`,{before:{emissive:t.emissive.getHexString(),emissiveIntensity:t.emissiveIntensity,color:t.color.getHexString()},original:{emissive:e.originalMaterialProps.emissive.getHexString(),emissiveIntensity:e.originalMaterialProps.emissiveIntensity,color:e.originalMaterialProps.color.getHexString()}}),t.emissive.copy(e.originalMaterialProps.emissive),t.emissiveIntensity=e.originalMaterialProps.emissiveIntensity,t.color.copy(e.originalMaterialProps.color),console.log(` Material restored for: ${e.type}`,{after:{emissive:t.emissive.getHexString(),emissiveIntensity:t.emissiveIntensity,color:t.color.getHexString()}})):(console.warn(` Cannot restore material for: ${e.type}`,{hasMaterial:!!e.mesh.material,isStandardMaterial:e.mesh.material instanceof q,hasOriginalProps:!!e.originalMaterialProps}),this.forceResetMaterial(e))}if(e.uniqueMaterial&&e.originalMaterialProps){const t=this.assetManager.createItem(e.type);if(t&&t.mesh.material){const s=Array.isArray(t.mesh.material)?t.mesh.material[0]:t.mesh.material;e.mesh.material=s,e.uniqueMaterial=void 0,console.log(` Restored original material reference for: ${e.type}`)}}if(this.removeSelectionRing(e),this.stopPulseAnimation(e),this.removeSelectionText(e),e.mesh.userData.group){e.mesh.userData.group.traverse(e=>{if(e instanceof d&&e.material&&e.userData.originalMaterial){const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof q&&(t.emissive.copy(e.userData.originalMaterial.emissive),t.emissiveIntensity=e.userData.originalMaterial.emissiveIntensity,t.color.copy(e.userData.originalMaterial.color))}}),console.log(` Group highlighting removed from: ${e.type}`)}console.log(` Highlighting removed from: ${e.type}`)}addSelectionRing(e){const t=new Ue(e.radius+.2,e.radius+.4,32),s=new T({color:65416,transparent:!0,opacity:.8,side:W}),i=new d(t,s);i.rotation.x=-Math.PI/2,i.position.copy(e.position),i.position.y=.01,e.selectionRing=i,this.scene.add(i)}removeSelectionRing(e){e.selectionRing&&(this.scene.remove(e.selectionRing),e.selectionRing=void 0)}startPulseAnimation(e){const t=e.mesh.scale.clone();if(e.mesh.userData.group){const t=e.mesh.userData.group,s=t.scale.clone(),i=new Ve(t.scale).to({x:1.1*s.x,y:1.1*s.y,z:1.1*s.z},800).easing(Xe.Quadratic.InOut).yoyo(!0).repeat(1/0);i.start(),e.pulseAnimation=i}else{const s=new Ve(e.mesh.scale).to({x:1.1*t.x,y:1.1*t.y,z:1.1*t.z},800).easing(Xe.Quadratic.InOut).yoyo(!0).repeat(1/0);s.start(),e.pulseAnimation=s}}stopPulseAnimation(e){if(e.pulseAnimation)if(e.pulseAnimation.stop(),e.pulseAnimation=null,e.mesh.userData.group){e.mesh.userData.group.scale.setScalar(1)}else e.originalScale&&e.mesh.scale.copy(e.originalScale)}addSelectionText(e){const t=document.createElement("canvas"),s=t.getContext("2d");t.width=256,t.height=64,s.fillStyle="#00FF88",s.font="bold 24px Arial",s.textAlign="center",s.fillText("DRAG TO MOVE",t.width/2,40),s.strokeStyle="#FFFFFF",s.lineWidth=2,s.strokeText("DRAG TO MOVE",t.width/2,40);const i=new ze(t),n=new Ge({map:i}),o=new Ke(n);if(o.position.copy(e.position),e.mesh.userData.group){const t=e.mesh.userData.group,s=(new Ae).setFromObject(t);o.position.y=s.max.y+.5}else o.position.y=e.mesh.geometry.boundingBox?.max.y||2;o.scale.set(2,.5,1),e.selectionText=o,this.scene.add(o)}removeSelectionText(e){e.selectionText&&(this.scene.remove(e.selectionText),e.selectionText=void 0)}forceResetMaterial(e){if(e.mesh.material){const t=Array.isArray(e.mesh.material)?e.mesh.material[0]:e.mesh.material;t instanceof q&&(console.log(` Force resetting material for: ${e.type}`),t.emissive.setHex(0),t.emissiveIntensity=0,e.originalMaterialProps&&t.color.copy(e.originalMaterialProps.color),console.log(` Material force reset for: ${e.type}`))}if(e.uniqueMaterial&&e.originalMaterialProps){const t=this.assetManager.createItem(e.type);if(t&&t.mesh.material){const s=Array.isArray(t.mesh.material)?t.mesh.material[0]:t.mesh.material;e.mesh.material=s,e.uniqueMaterial=void 0,console.log(` Force restored original material reference for: ${e.type}`)}}}startDragging(e){this.isDragging=!0;const t=this.renderer.domElement.getBoundingClientRect(),s=(this.mouse.x+1)/2*t.width,n=(1-this.mouse.y)/2*t.height,o=new i(s,0,n);this.dragOffset.copy(e.position).sub(o),console.log(" Started dragging item")}startPlacingItem(e){this.isPlacing=!0,this.selectedItemType=e,console.log(` Starting placement for ${e} - isPlacing: ${this.isPlacing}, selectedType: ${this.selectedItemType}`),this.selectedItem&&(console.log(" Clearing previous selection before starting placement"),this.deselectItem()),this.showGrid(),this.uiManager&&this.uiManager.updatePlacementStatus("Click on garden to place item"),this.previewItem=this.assetManager.createItem(e),this.previewItem?console.log(` Preview item created for ${e}, ready for placement. State: isPlacing=${this.isPlacing}, selectedType=${this.selectedItemType}`):(console.error(` Failed to create item for ${e}`),this.cancelPlacement())}isPositionValid(e){if("stone_path"===this.selectedItemType){const t=2,s=e.x>=-20+t&&e.x<=20-t&&e.z>=-15+t&&e.z<=15-t;return console.log(" Stone path position validation:",e,"Valid:",s),s}const t=this.gardenBounds.containsPoint(e);return console.log(" Position validation:",e,"Bounds:",this.gardenBounds.min,"to",this.gardenBounds.max,"Valid:",t),t}wouldOverlap(e,t){for(const s of this.placedItems){if(s===this.selectedItem)continue;const i="stone_path"===this.selectedItemType&&"stone_path"===s.type?2:t+s.radius,n=e.distanceTo(s.position);if(n<i)return console.log(` Overlap detected: ${this.selectedItemType} at distance ${n.toFixed(2)} from ${s.type} (min: ${i.toFixed(2)})`),!0}return console.log(` No overlap detected for ${this.selectedItemType} at:`,e),!1}animateItemSpawn(e){e.mesh.scale.set(.6,.6,.6);const t=new Ve(e.mesh.scale).to({x:1,y:1,z:1},500).easing(Xe.Back.Out),s=e.position.y;e.position.y=-.5;const i=new Ve(e.position).to({y:s+.3},300).easing(Xe.Bounce.Out).onComplete(()=>{new Ve(e.position).to({y:s},200).easing(Xe.Quadratic.Out).start()});t.start(),i.start()}cancelPlacement(){this.isPlacing=!1,this.selectedItemType=null,this.hideGrid(),this.uiManager&&this.uiManager.updatePlacementStatus("Click an item to start placing"),this.previewItem&&(this.previewItem=null)}deleteSelectedItem(){if(this.selectedItem){this.removeHighlight(this.selectedItem),this.scene.remove(this.selectedItem.mesh);const e=this.placedItems.indexOf(this.selectedItem);e>-1&&this.placedItems.splice(e,1),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems),console.log(` Deleted item: ${this.selectedItem.type}`),this.selectedItem=null,this.isDragging=!1}}makeGnomeDisappear(e,t){this.audioManager.playClick();const s=new i(0,0,0),n=()=>{if(t.scale.lerp(s,.1),t.scale.length()>.01)requestAnimationFrame(n);else{this.scene.remove(t);const s=this.placedItems.indexOf(e);s>-1&&this.placedItems.splice(s,1),this.dragAndDropManager&&this.dragAndDropManager.updatePlacedItems(this.placedItems),this.foundGnomes++,this.updateGnomeCounter(),console.log(` Gnome disappeared! Found: ${this.foundGnomes}/${this.totalGnomes}`)}};n()}updateGnomeCounter(){this.uiManager&&this.uiManager.updateGnomeCounter(this.foundGnomes,this.totalGnomes)}onWindowResize(){this.camera.aspect=1920/1080,this.camera.updateProjectionMatrix(),this.renderer.setSize(1920,1080)}animate(){requestAnimationFrame(()=>this.animate()),Ye(),this.controls.update(),this.updateLightpoleBulb(),this.composer.render()}setupDebugButtons(){const e=document.getElementById("debug-panel");e&&function(e,t,s){if(!t||0===t.length)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in $e)return;$e[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(s)for(let s=i.length-1;s>=0;s--){const n=i[s];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise((t,s)=>{o.addEventListener("load",t),o.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})}(()=>Promise.resolve().then(()=>fs),void 0).then(({UI_CONFIG:t})=>{t.debug?(e.style.display="block",this.setupDebugButtonListeners()):e.style.display="none"}),this.setupDayNightButton()}setupDebugButtonListeners(){const e=document.getElementById("debug-console-btn");e?(e.addEventListener("click",()=>{console.log(" Debug console button clicked!"),this.showDebugInfo()}),console.log(" Debug console button event listener added")):console.log(" Debug console button not found in HTML")}showDebugInfo(){const e={assetManager:this.assetManager?"Initialized":"Not initialized",scene:this.scene?`Children: ${this.scene.children.length}`:"Not initialized",placedItems:this.placedItems.length,capturedLogs:this.capturedLogs.length};console.log(" Debug Info:",e),alert(`Debug Info:\n${JSON.stringify(e,null,2)}`)}toggleDayNight(){this.dayNightSystem&&(this.dayNightSystem.toggleDayNight(),this.updateDayNightButton())}setupDayNightButton(){const e=document.getElementById("day-night-toggle");e?(e.addEventListener("click",()=>{console.log(" Day/Night toggle button clicked!"),this.toggleDayNight()}),console.log(" Day/Night toggle button event listener added")):console.log(" Day/Night toggle button not found in HTML");const t=document.getElementById("music-toggle");t?(t.addEventListener("click",()=>{console.log(" Music toggle button clicked!"),this.toggleMusic()}),console.log(" Music toggle button event listener added")):console.log(" Music toggle button not found in HTML")}updateDayNightButton(){const e=document.getElementById("day-night-toggle");if(e&&this.dayNightSystem){"day"===this.dayNightSystem.getCurrentMode()?(e.textContent=" Day Mode",e.classList.remove("night")):(e.textContent=" Night Mode",e.classList.add("night"))}}toggleMusic(){this.audioManager&&(this.audioManager.toggleTheme(),this.updateMusicButton())}updateMusicButton(){const e=document.getElementById("music-toggle");if(e&&this.audioManager){this.audioManager.isThemeActive()?(e.textContent=" Stop Music",e.classList.add("playing")):(e.textContent=" Play Music",e.classList.remove("playing"))}}dispose(){this.controls&&this.controls.dispose(),this.renderer&&this.renderer.dispose(),this.composer&&this.composer.dispose()}ensureCleanMaterials(e){if(console.log(` Ensuring clean materials for newly placed item: ${e.type}`),e.mesh.material){const t=Array.isArray(e.mesh.material)?e.mesh.material[0]:e.mesh.material;t instanceof q&&(e.originalMaterialProps||(e.originalMaterialProps={emissive:t.emissive.clone(),emissiveIntensity:t.emissiveIntensity,color:t.color.clone()},console.log(` Stored original material props for new item: ${e.type}`)),t.emissive.setHex(0),t.emissiveIntensity=0,console.log(` Cleaned main mesh materials for: ${e.type}`))}if(e.mesh.userData.group){e.mesh.userData.group.traverse(e=>{if(e instanceof d&&e.material){const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof q&&(e.userData.originalMaterial||(e.userData.originalMaterial={emissive:t.emissive.clone(),emissiveIntensity:t.emissiveIntensity,color:t.color.clone()}),t.emissive.setHex(0),t.emissiveIntensity=0)}}),console.log(` Cleaned group mesh materials for: ${e.type}`)}e.uniqueMaterial=void 0,console.log(` Materials cleaned for newly placed item: ${e.type}`)}}const As=()=>{const e=document.getElementById("loading");e&&(e.style.opacity="0",e.style.transition="opacity 0.5s ease-out",setTimeout(()=>e.remove(),500))};document.addEventListener("DOMContentLoaded",async()=>{try{(()=>{const e=document.createElement("div");e.id="loading",e.innerHTML='\n    <div style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n      color: white;\n      font-family: Arial, sans-serif;\n    ">\n      <div style="\n        width: 60px;\n        height: 60px;\n        border: 4px solid #4CAF50;\n        border-top: 4px solid transparent;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n        margin-bottom: 20px;\n      "></div>\n      <h2 style="margin: 0; color: #4CAF50;">Loading Garden Designer</h2>\n      <p style="margin: 10px 0; opacity: 0.8;">Initializing 3D environment...</p>\n    </div>\n    <style>\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    </style>\n  ',document.body.appendChild(e)})(),await new Promise(e=>setTimeout(e,1e3)),new Ts,As()}catch(e){console.error("Failed to initialize Garden Designer:",e),As();const t=document.createElement("div");t.innerHTML='\n      <div style="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(255, 0, 0, 0.9);\n        color: white;\n        padding: 20px;\n        border-radius: 10px;\n        text-align: center;\n        font-family: Arial, sans-serif;\n      ">\n        <h3>Error Loading Application</h3>\n        <p>Failed to initialize the Garden Designer.</p>\n        <p>Please refresh the page or check your browser console.</p>\n        <button onclick="location.reload()" style="\n          background: white;\n          color: red;\n          border: none;\n          padding: 10px 20px;\n          border-radius: 5px;\n          cursor: pointer;\n          margin-top: 10px;\n        ">Refresh Page</button>\n      </div>\n    ',document.body.appendChild(t)}});
